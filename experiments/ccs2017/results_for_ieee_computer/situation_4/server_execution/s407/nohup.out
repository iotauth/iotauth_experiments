changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s407.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's407',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 67 49 42 41 41 4b 43 41 51 45 41 72 35 ... > }
Handler: listening on port 22100
s407:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200002
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35102
received auth hello!
{ authId: 402, nonce: <Buffer eb 0d 58 86 f3 b3 ab f5> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 69 49 f3 d6 cc d6 98 b8>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 14 90 e7 36 72 fb ec ce f7 b2 73 75 94 35 e3 37>,
  macKeyVal: <Buffer 28 3d a0 a1 c1 6a f7 55 f3 55 20 10 2b 7e 36 ff 50 12 80 c6 e8 57 ee 13 a2 b5 18 00 ec ca 90 2c>,
  absValidity: 2018-08-27T04:32:59.112Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer fa 64 e2 f4 13 dd d2 ff>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer fa 64 e2 f4 13 dd d2 ff> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.51:55558',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200009
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35302
received auth hello!
{ authId: 402, nonce: <Buffer 6d 97 22 2d f4 c1 f0 ca> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c9 64 9a 63 b0 f2 be 9c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 99 56 7b 7f 9a 2f 4f 92>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 99 56 7b 7f 9a 2f 4f 92> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.51:55758',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200016
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35568
received auth hello!
{ authId: 402, nonce: <Buffer 65 1a c0 4b a6 8e 86 cc> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer cc 6a 2c 89 d3 8e c1 43>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 64 f5 80 2c 12 5a 7e 18>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 64 f5 80 2c 12 5a 7e 18> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.51:56024',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200023
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35838
received auth hello!
{ authId: 402, nonce: <Buffer 88 58 ec 86 5f ac 28 23> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5c 29 99 99 f3 ec 2a f4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a0 6a 87 f1 0b 72 99 14>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer a0 6a 87 f1 0b 72 99 14> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.51:56294',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200030
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 36108
received auth hello!
{ authId: 402, nonce: <Buffer 84 8b 17 cc 60 65 c7 38> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 81 9d 60 6a 2d 37 21 dc>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 4b fd 08 f0 f3 11 ad 37>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 4b fd 08 f0 f3 11 ad 37> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.51:56564',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200037
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 36378
received auth hello!
{ authId: 402, nonce: <Buffer 5b a6 1c dd 9f bc 23 d0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 50 1f 12 8c 61 8f 20 a3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 83 df a4 33 0e 90 42 01>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 83 df a4 33 0e 90 42 01> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.51:56834',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200044
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 36648
received auth hello!
{ authId: 402, nonce: <Buffer 9a de 56 54 14 24 18 b4> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 33 ac a0 af 9b 6e 2f 7a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ef a7 75 79 26 af 5d f5>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ef a7 75 79 26 af 5d f5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.51:57104',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200051
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 36918
received auth hello!
{ authId: 402, nonce: <Buffer 42 1e 05 0e 77 e0 1c 2c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 62 25 45 88 2e 22 1f d2>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 13 98 03 70 8f 61 ae 19>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 13 98 03 70 8f 61 ae 19> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.51:57374',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300075
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300085
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 56634
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 2e be 44 43 80 5b 2c a3> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300095
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 56888
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer e0 49 ed 30 88 5b 61 e6> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300105
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300115
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 56036
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
