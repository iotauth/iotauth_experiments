changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s504.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's504',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 76 38 ... > }
Handler: listening on port 22100
s504:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100003
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47662
received auth hello!
{ authId: 501, nonce: <Buffer eb 74 f9 a3 81 bf bb 0a> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 46 2b 10 7d e1 09 c0 8d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 1e 21 70 b3 02 f3 78 12 27 eb 96 09 ad 85 9e f2>,
  macKeyVal: <Buffer 25 88 1b 4a f4 e8 24 4c e0 61 e7 c9 e6 da 66 1d 5e 2e 0c ac 8d 8a f3 06 ab 3e 95 5d f7 69 30 fd>,
  absValidity: 2018-08-27T04:33:51.267Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer cd 09 7e 55 b0 cd 45 ff>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer cd 09 7e 55 b0 cd 45 ff> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.67:51736',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100011
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47916
received auth hello!
{ authId: 501, nonce: <Buffer a2 42 7e b0 52 5a ba 2f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 7b f3 f0 ad 84 8e 11 df>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 40 71 d8 4f 12 f5 0d d1>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 40 71 d8 4f 12 f5 0d d1> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.67:51990',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100019
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48186
received auth hello!
{ authId: 501, nonce: <Buffer 95 ef 14 9e 44 c7 d0 71> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 96 68 6e 3c fe ac c2 b7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5f ef b9 2f 83 8d 6b ef>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 5f ef b9 2f 83 8d 6b ef> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.67:52260',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100027
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48456
received auth hello!
{ authId: 501, nonce: <Buffer 37 13 36 c7 71 af 1f 07> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 64 74 53 bd 8b fc f8 98>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d6 73 63 5c 89 60 09 72>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d6 73 63 5c 89 60 09 72> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.67:52530',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100035
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48726
received auth hello!
{ authId: 501, nonce: <Buffer 0d f2 d0 31 77 53 26 6d> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 8f 10 0c 7a dd 8f 0f 58>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e6 98 3b 79 ae bb 8e 50>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e6 98 3b 79 ae bb 8e 50> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.67:52800',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100043
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48996
received auth hello!
{ authId: 501, nonce: <Buffer 2b 7b e5 2f 6c 84 72 44> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 90 32 0c bf 58 ef 78 c6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 98 95 dc 63 42 f6 c8 d4>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 98 95 dc 63 42 f6 c8 d4> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.67:53070',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100051
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 49266
received auth hello!
{ authId: 501, nonce: <Buffer 02 3b f7 71 25 67 38 92> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer de 77 06 ac ca ab 67 8e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 49 ba a0 2d fc 69 d2 b9>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 49 ba a0 2d fc 69 d2 b9> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.67:53340',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200091
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200106
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 58490
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200121
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 58732
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200136
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200151
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 45428
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 15 95 c9 fa 23 72 94 0b> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth501',
     commonName: '10.0.0.4' },
  serial: '0165796FA793',
  notBefore: 2018-08-27T03:29:45.000Z,
  notAfter: 2018-08-28T03:31:25.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '28:4D:FE:20:04:D7:86:93:50:8F:46:8A:7B:CA:60:2F:B5:59:40:2A',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'B138D36BE53FEF7A4EAFB969AC06E51234F04819636E9BD1C18A274EF509C20F60425ECB70D73DBE38728E4C8AE5C9A51F6B212017E83DB7265ADE4EB91743FF00E6384C91216C08E24F877D4756852A1A006533657C2AD970B6694EAA6074DD788860A9BBCCF0D830F5A7FED589C63785576A172E75E8EA5C2AFC1B8563D3B27BB7450A9659E288F607AA1643255BB6082A7AF57221C9DB5DDE2AFA6C5D86E13162450B4905BD4511BE1D82F1A3D32974AE25E6317777B2B45BA251A2511FFC8EF6FAE19E1CFC5BEEC19ADFE72E99C553F36401DCCA304F5C309892EE68C67986CBBFB67CEC5666ADDA8CD6487848CF2EDC5C68B7924C91D54BBEC322B2C309',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5b6eTMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDExETAPBgNVBAMMCDEwLjAuMC40MB4XDTE4MDgy\nNzAzMjk0NVoXDTE4MDgyODAzMzEyNVowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCxONNr5T/vek6vuWmsBuUSNPBIGWNum9HBiidO9QnCD2BCXstw\n1z2+OHKOTIrlyaUfayEgF+g9tyZa3k65F0P/AOY4TJEhbAjiT4d9R1aFKhoAZTNl\nfCrZcLZpTqpgdN14iGCpu8zw2DD1p/7VicY3hVdqFy516OpcKvwbhWPTsnu3RQqW\nWeKI9geqFkMlW7YIKnr1ciHJ213eKvpsXYbhMWJFC0kFvUURvh2C8aPTKXSuJeYx\nd3eytFuiUaJRH/yO9vrhnhz8W+7Bmt/nLpnFU/NkAdzKME9cMJiS7mjGeYbLv7Z8\n7FZmrdqM1kh4SM8u3Fxot5JMkdVLvsMissMJAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAGPh9ZnSjprQKYeCkVdeTsaHZAXxL0Pg\nMmj4X6bce1rs2wQGWxTN85kGlS97uDLCZ65sKGSaVDHBoG3SjBwqVFjdzjetWjIK\nCbdrd76/CpHMpEcQXaykLJMcpZIqEQ5qlTf89v7Vf6qo9sxAAP2pE5IinTPQyrZl\nAAEG9oSeEPJ0JwLbgQSZT5OiOuw3fNI4IwVMEwRiOD4gGMq2I++PDuZ2xHovXLgr\nTVRjrAWjF2rjBQ1Gz4jwm5PXu3H7r5aGrQampI1Nl4KrPwN3PlX9ujlICNbYJtNb\n5FP+iZOgaYB+MPoiuiH9/WzlRRGPgHP44V6S4dc23S6/NmGZpb47tm8=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200162
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 45680
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200175
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 45932
received auth hello!
{ authId: 502, nonce: <Buffer 80 2c e7 25 29 80 3e 59> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer b1 b1 68 bd e5 35 0b 1a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 50 2b 18 24 90 a0 c2 db 2e 5b 05 ff 16 e4 a2 75>,
  macKeyVal: <Buffer c2 e7 ca f3 5a 9a df 83 7c 92 79 79 1f 83 0a 65 4c 6e 0e 3a f0 ae ff ce ee a9 69 b3 d6 41 ed 64>,
  absValidity: 2018-08-27T04:51:58.885Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 01 7b 27 21 a8 30 2e 48>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 01 7b 27 21 a8 30 2e 48> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.67:56144',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200190
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46240
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200203
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46462
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
