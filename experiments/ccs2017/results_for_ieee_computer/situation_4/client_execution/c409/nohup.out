changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for autoClient: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Clients/c409.config
initializing...
current parameters: { numKeysPerRequest: 3,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 'c409',
  group: 'Clients',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 7a 69 ... > }
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 0 1 0 1535340778367
connected to auth! from local port 48446
received auth hello!
{ authId: 402, nonce: <Buffer 0e b9 5a 89 43 f8 66 72> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer d9 03 be 7e 93 4c b6 90>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer c5 5a 7f a1 89 6d a2 17 4e ae bb 9a 5b 37 98 f0>,
  macKeyVal: <Buffer 6c c3 c5 a1 98 65 f8 6b 9c ab 45 7f a7 e4 38 12 ea b2 b2 5a fa a5 5a 5e d9 ef 03 53 69 d0 80 30>,
  absValidity: 2018-08-27T04:32:58.525Z }
received 1 keys
currentSessionKey: [object Object]
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200002,
  cipherKeyVal: <Buffer 4e c7 20 99 e5 a7 95 12 c2 0f e1 79 ee 64 57 7b>,
  macKeyVal: <Buffer c2 aa d3 83 a0 e7 68 a8 e2 75 19 27 f6 a8 43 d5 bd 88 49 6c bc f0 7d fa 62 74 40 a0 44 b3 26 f4>,
  absValidity: 2018-08-28T03:32:58.525Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200002,
     cipherKeyVal: <Buffer 4e c7 20 99 e5 a7 95 12 c2 0f e1 79 ee 64 57 7b>,
     macKeyVal: <Buffer c2 aa d3 83 a0 e7 68 a8 e2 75 19 27 f6 a8 43 d5 bd 88 49 6c bc f0 7d fa 62 74 40 a0 44 b3 26 f4>,
     absValidity: 2018-08-28T03:32:58.525Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
disconnected from auth
chosen nonce: <Buffer 7c 97 ab 5f 7c 50 cc 47>
switching to HANDSHAKE_1_SENT
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:32:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 1 1 1 1535340779501
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 1 2 0.5 1535340838399
connected to auth! from local port 48646
received auth hello!
{ authId: 402, nonce: <Buffer 71 58 2d 0b 43 7a 34 be> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 30 16 b4 54 63 6f 39 90>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200009,
  cipherKeyVal: <Buffer f0 fa 99 da 81 9c a8 91 aa 67 9e 83 39 29 b7 85>,
  macKeyVal: <Buffer 2b 68 01 05 d6 6c 6a 64 4f 51 e6 b2 52 fb c9 b4 9a 24 bc 1c 6e 99 93 e9 5c cb fd 48 15 b4 d9 aa>,
  absValidity: 2018-08-28T03:33:58.570Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200009,
     cipherKeyVal: <Buffer f0 fa 99 da 81 9c a8 91 aa 67 9e 83 39 29 b7 85>,
     macKeyVal: <Buffer 2b 68 01 05 d6 6c 6a 64 4f 51 e6 b2 52 fb c9 b4 9a 24 bc 1c 6e 99 93 e9 5c cb fd 48 15 b4 d9 aa>,
     absValidity: 2018-08-28T03:33:58.570Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer af 21 7a 87 eb e1 98 53>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:33:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 2 2 1 1535340839577
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 2 3 0.6666666666666666 1535340898453
connected to auth! from local port 48912
received auth hello!
{ authId: 402, nonce: <Buffer 6e db 13 1a 32 a7 71 eb> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 1e 39 2b 59 c2 d2 7b 00>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200016,
  cipherKeyVal: <Buffer b1 f0 74 ef 2a 71 1a 49 b5 0e 69 5d be a7 5a 89>,
  macKeyVal: <Buffer 75 42 0b f2 62 37 63 0d 94 d7 84 23 42 27 28 98 1b dd a5 3d 99 38 c6 a2 08 30 58 2b 0f a9 c6 0b>,
  absValidity: 2018-08-28T03:34:58.626Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200016,
     cipherKeyVal: <Buffer b1 f0 74 ef 2a 71 1a 49 b5 0e 69 5d be a7 5a 89>,
     macKeyVal: <Buffer 75 42 0b f2 62 37 63 0d 94 d7 84 23 42 27 28 98 1b dd a5 3d 99 38 c6 a2 08 30 58 2b 0f a9 c6 0b>,
     absValidity: 2018-08-28T03:34:58.626Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer ba 24 16 c9 d7 2d 4a ca>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:34:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 3 3 1 1535340899562
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 3 4 0.75 1535340958512
connected to auth! from local port 49182
received auth hello!
{ authId: 402, nonce: <Buffer 50 9e 9c 91 39 1e c3 e1> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f6 b9 88 d9 bc 86 b3 d1>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200023,
  cipherKeyVal: <Buffer 73 05 79 5f 3a d8 6e 48 2f 6a ef 3e 3a d8 75 02>,
  macKeyVal: <Buffer 42 b1 a9 6c 78 d8 a4 c1 33 43 97 c1 83 d3 44 ed ee 61 c2 bb c6 c1 3f 36 a1 c6 b3 9b 29 17 5a 29>,
  absValidity: 2018-08-28T03:35:58.676Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200023,
     cipherKeyVal: <Buffer 73 05 79 5f 3a d8 6e 48 2f 6a ef 3e 3a d8 75 02>,
     macKeyVal: <Buffer 42 b1 a9 6c 78 d8 a4 c1 33 43 97 c1 83 d3 44 ed ee 61 c2 bb c6 c1 3f 36 a1 c6 b3 9b 29 17 5a 29>,
     absValidity: 2018-08-28T03:35:58.676Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 10 94 87 b4 7d a7 80 26>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:35:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 4 4 1 1535340959560
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 4 5 0.8 1535341018568
connected to auth! from local port 49452
received auth hello!
{ authId: 402, nonce: <Buffer 2b fe e4 03 ee 86 22 01> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 65 e7 f7 c8 44 d3 2b 96>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200030,
  cipherKeyVal: <Buffer 61 55 69 01 83 e3 f2 9b 71 12 5d ce c5 92 f8 8c>,
  macKeyVal: <Buffer db 75 30 2d 8d 33 5e 2f 8b 1f 33 be 71 28 f5 f2 25 4f af 23 48 d8 c8 44 b0 0c d1 fe a3 b6 24 51>,
  absValidity: 2018-08-28T03:36:58.719Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200030,
     cipherKeyVal: <Buffer 61 55 69 01 83 e3 f2 9b 71 12 5d ce c5 92 f8 8c>,
     macKeyVal: <Buffer db 75 30 2d 8d 33 5e 2f 8b 1f 33 be 71 28 f5 f2 25 4f af 23 48 d8 c8 44 b0 0c d1 fe a3 b6 24 51>,
     absValidity: 2018-08-28T03:36:58.719Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 29 cd 6c 0a 72 d9 31 8a>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:36:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 5 5 1 1535341019630
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 5 6 0.8333333333333334 1535341078624
connected to auth! from local port 49722
received auth hello!
{ authId: 402, nonce: <Buffer a1 06 7a b7 8c f6 ed 7b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 29 45 92 47 7c eb 4f b7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200037,
  cipherKeyVal: <Buffer 4d ca 52 aa b2 cc 34 24 4f a5 c0 6f 25 00 bc ac>,
  macKeyVal: <Buffer bd 17 3c 5c 78 55 3c bd e4 db 2d ba e4 16 15 5d 7d 4c 64 4a cf 61 d4 68 38 10 38 39 e2 be cd 3b>,
  absValidity: 2018-08-28T03:37:58.760Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200037,
     cipherKeyVal: <Buffer 4d ca 52 aa b2 cc 34 24 4f a5 c0 6f 25 00 bc ac>,
     macKeyVal: <Buffer bd 17 3c 5c 78 55 3c bd e4 db 2d ba e4 16 15 5d 7d 4c 64 4a cf 61 d4 68 38 10 38 39 e2 be cd 3b>,
     absValidity: 2018-08-28T03:37:58.760Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer fc 10 fe a3 3f f2 b2 c8>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:37:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 6 6 1 1535341079679
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 6 7 0.8571428571428571 1535341138680
connected to auth! from local port 49992
received auth hello!
{ authId: 402, nonce: <Buffer f7 df 94 61 6e 87 20 7d> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f0 40 65 9a 02 84 25 ea>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200044,
  cipherKeyVal: <Buffer de 65 54 27 4c ea 3f 94 8f 27 80 b0 bc 3a 1d 11>,
  macKeyVal: <Buffer df 02 06 69 bb 2e d6 ec d9 15 46 0d d4 14 1b 94 78 4a e2 38 7a be 1f f2 73 40 14 2d e8 ad f0 6c>,
  absValidity: 2018-08-28T03:38:58.834Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200044,
     cipherKeyVal: <Buffer de 65 54 27 4c ea 3f 94 8f 27 80 b0 bc 3a 1d 11>,
     macKeyVal: <Buffer df 02 06 69 bb 2e d6 ec d9 15 46 0d d4 14 1b 94 78 4a e2 38 7a be 1f f2 73 40 14 2d e8 ad f0 6c>,
     absValidity: 2018-08-28T03:38:58.834Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 7f c6 b6 4c b2 ed 98 6f>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:38:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 7 7 1 1535341139821
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 7 8 0.875 1535341198734
connected to auth! from local port 50262
received auth hello!
{ authId: 402, nonce: <Buffer 0c 91 e9 86 a8 35 9e 58> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 08 63 f2 e0 a5 ce e4 a7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40200051,
  cipherKeyVal: <Buffer 1c 7f a6 3d 50 43 33 82 87 1e 6c 87 01 70 58 d8>,
  macKeyVal: <Buffer 31 52 ce 90 b8 34 f4 c3 41 83 27 58 77 b6 a5 cf ac c8 dc a2 a1 3d d5 cf ce 6b 4b 62 db b8 2f 0a>,
  absValidity: 2018-08-28T03:39:58.883Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 40200051,
     cipherKeyVal: <Buffer 1c 7f a6 3d 50 43 33 82 87 1e 6c 87 01 70 58 d8>,
     macKeyVal: <Buffer 31 52 ce 90 b8 34 f4 c3 41 83 27 58 77 b6 a5 cf ac c8 dc a2 a1 3d d5 cf ce 6b 4b 62 db b8 2f 0a>,
     absValidity: 2018-08-28T03:39:58.883Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 52 3a fc bf d1 00 53 2c>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:39:59 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 8 8 1 1535341199673
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 9 0.8888888888888888 1535341258740
failure in connection with Auth : authFailureCount: 1
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 10 0.8 1535341318750
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 42052
received auth hello!
{ authId: 502, nonce: <Buffer fb 8f 9a 0e 84 e2 55 86> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 11 0.7272727272727273 1535341378761
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 42280
received auth hello!
{ authId: 502, nonce: <Buffer c9 ce 7b 32 6b 7a c6 6c> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 12 0.6666666666666666 1535341438771
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 13 0.6153846153846154 1535341498778
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 56550
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 14 0.5714285714285714 1535341558785
failure in connection with Auth : authFailureCount: 6
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 56786
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 15 0.5333333333333333 1535341618792
failure in connection with Auth : authFailureCount: 7
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 2
to: 3
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.3:21100
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 16 0.5 1535341678796
failure in connection with Auth : authFailureCount: 8
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 3
to: 4
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 58128
received auth hello!
{ authId: 503, nonce: <Buffer dd 38 50 a3 dd e8 bf e1> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth503',
     commonName: '10.0.1.6' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth402',
     commonName: '10.0.0.2' },
  serial: '0165796FA46B',
  notBefore: 2018-08-27T03:29:44.000Z,
  notAfter: 2018-08-28T03:31:24.000Z,
  subjectHash: '5542437f',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: 'B0:E4:E5:5F:9E:CB:06:62:C1:1C:04:D2:03:C0:0F:F3:08:57:F8:E6',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'B23F6093C850A1F776C6B25A211F3D5D8785C0DAD492C4DE461DA15D8F9B6101A99371495C8D7E30C245C7CC7E2E192E5B5EB588DBBBDBA927B35EDD2BAE5D8C5C65824B855A9221C4466C8784616AD037B77C8AADC6EF39D05015670368020871C42CAC357EA02550E2A7B413707218579A29BD6E3766CDC96E0C38274B71EADD932F983948893BE88DFCA5822A49F903804459FF6A6BE5F8D58602F470CF3B3720B509B13C86CB937B7103FB5BB709F3236962F0A80B162386009C70550963F281A68E509BD7FD3B899E2D99BBF01E7FAD284D2AA9766FC563E437A20FC2DB9E924A4047450953A3342A8380752168F1038EC6A4763C6E85566CE28AE879E7',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.6' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 503,
  host: '10.0.1.6',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5b6RrMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg0MDIxETAPBgNVBAMMCDEwLjAuMC4yMB4XDTE4MDgy\nNzAzMjk0NFoXDTE4MDgyODAzMzEyNFowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMzERMA8GA1UEAwwIMTAuMC4xLjYwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCyP2CTyFCh93bGslohHz1dh4XA2tSSxN5GHaFdj5thAamTcUlc\njX4wwkXHzH4uGS5bXrWI27vbqSezXt0rrl2MXGWCS4VakiHERmyHhGFq0De3fIqt\nxu850FAVZwNoAghxxCysNX6gJVDip7QTcHIYV5opvW43Zs3Jbgw4J0tx6t2TL5g5\nSIk76I38pYIqSfkDgERZ/2pr5fjVhgL0cM87NyC1CbE8hsuTe3ED+1u3CfMjaWLw\nqAsWI4YAnHBVCWPygaaOUJvX/TuJni2Zu/Aef60oTSqpdm/FY+Q3og/C256SSkBH\nRQlTozQqg4B1IWjxA47GpHY8boVWbOKK6HnnAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQYwDQYJKoZIhvcNAQELBQADggEBAHimGYeBFTk1nGO26iqikUZTSdUKpnDK\n1wAqZWF59AYw4GIh8K8hwY89yfxiEPdadTHuHhROS2TNmi5Qhmjm2T9LeoVfXDFp\nvlnxCk14MXmYJPtVM/f+auUcudUgffLF4JpR6AsA2Loke6FxQHTkZgrPFByluQHu\n6KN55vWS7t1zlXLQLx5UFjSHeulMjTdnZ9Ev+zKxzZVnbK1rIsedCi15tiqIDtqE\n7moQ/RLtqDYKe83XIvg/NsV3wK0FiOTEFo5Pd5LKrcUUxcpnGQNGti5A8XSxQ4tR\ngI9dbZudraBvrMOB1eFFyunFPks8RVIs6shkmXxXg5MkMTdGXf3VWKo=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 4
to: 5
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 17 0.47058823529411764 1535341738797
connected to auth! from local port 58356
received auth hello!
{ authId: 503, nonce: <Buffer d1 b1 f4 29 bb b7 91 a8> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer ad c8 8f 00 82 76 34 00>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer d9 1b 62 34 eb 39 05 2e 09 cc 31 37 61 f6 2d ef>,
  macKeyVal: <Buffer 57 b6 1d d7 f6 e9 80 aa 60 16 2d 23 08 4c 19 ec ec 94 bf a5 ce ba 51 79 52 6d c1 b8 ba ac 16 e2>,
  absValidity: 2018-08-27T04:48:59.012Z }
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50300075,
  cipherKeyVal: <Buffer 79 05 fc a9 a0 48 0a f9 48 62 32 1e 07 68 ac 83>,
  macKeyVal: <Buffer 4f 2f 46 25 74 c1 13 a5 8e 62 f3 55 cb 77 d3 fb cf 63 91 9e 3c 98 27 a9 50 28 4b 14 56 1d a3 72>,
  absValidity: 2018-08-28T03:48:59.012Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 50300075,
     cipherKeyVal: <Buffer 79 05 fc a9 a0 48 0a f9 48 62 32 1e 07 68 ac 83>,
     macKeyVal: <Buffer 4f 2f 46 25 74 c1 13 a5 8e 62 f3 55 cb 77 d3 fb cf 63 91 9e 3c 98 27 a9 50 28 4b 14 56 1d a3 72>,
     absValidity: 2018-08-28T03:48:59.012Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
disconnected from auth
chosen nonce: <Buffer c9 18 b1 64 3e 36 a1 e0>
switching to HANDSHAKE_1_SENT
Handler: secure connection with the server closed.
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.14:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 18 0.4444444444444444 1535341798806
connected to auth! from local port 58610
received auth hello!
{ authId: 503, nonce: <Buffer 79 4f ea b3 6e e6 53 c8> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a4 73 67 2f 4c 1f 70 d3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50300085,
  cipherKeyVal: <Buffer 27 54 4a 98 79 c2 b9 db dd d2 23 1d 62 f4 4e 7f>,
  macKeyVal: <Buffer e7 8e 0f 07 9b 61 c8 2c 4f d7 88 32 72 c5 9a cd cc 1d 33 28 98 83 f5 f5 e4 c8 23 5b 77 7b 60 df>,
  absValidity: 2018-08-28T03:49:58.926Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 50300085,
     cipherKeyVal: <Buffer 27 54 4a 98 79 c2 b9 db dd d2 23 1d 62 f4 4e 7f>,
     macKeyVal: <Buffer e7 8e 0f 07 9b 61 c8 2c 4f d7 88 32 72 c5 9a cd cc 1d 33 28 98 83 f5 f5 e4 c8 23 5b 77 7b 60 df>,
     absValidity: 2018-08-28T03:49:58.926Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer bc 0c c5 2f d1 89 84 aa>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.14:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 19 0.42105263157894735 1535341858816
connected to auth! from local port 58864
received auth hello!
{ authId: 503, nonce: <Buffer 45 f8 e9 60 a5 2f 79 37> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 77 7a ef 94 b8 7e bc 74>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50300095,
  cipherKeyVal: <Buffer 17 6b cd 4b de 8d ca 42 ec 74 72 53 b7 ae 47 f3>,
  macKeyVal: <Buffer a3 7c 4d bf 3e 7e 4e f8 45 bd 6e 07 2c 98 0b eb 20 25 bf 2a 53 06 0d fd 05 0d cd af 3e ac d1 1d>,
  absValidity: 2018-08-28T03:50:59.073Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 50300095,
     cipherKeyVal: <Buffer 17 6b cd 4b de 8d ca 42 ec 74 72 53 b7 ae 47 f3>,
     macKeyVal: <Buffer a3 7c 4d bf 3e 7e 4e f8 45 bd 6e 07 2c 98 0b eb 20 25 bf 2a 53 06 0d fd 05 0d cd af 3e ac d1 1d>,
     absValidity: 2018-08-28T03:50:59.073Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 59 72 a5 09 2d 6c 6b ba>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.14:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 20 0.4 1535341918824
connected to auth! from local port 59114
received auth hello!
{ authId: 503, nonce: <Buffer de 53 e3 22 f8 0a 36 15> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer dd 0a 1a b2 db fa 0c 30>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50300105,
  cipherKeyVal: <Buffer ad ec b9 3b 42 71 ab 8a 42 40 64 99 17 3a 2e 59>,
  macKeyVal: <Buffer 31 5e 52 47 b1 b4 56 59 3b ce 2d fb 99 0a 44 cd 8e 3a 62 62 10 7f dd 42 42 7f 26 5c 29 d4 68 08>,
  absValidity: 2018-08-28T03:51:59.000Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 50300105,
     cipherKeyVal: <Buffer ad ec b9 3b 42 71 ab 8a 42 40 64 99 17 3a 2e 59>,
     macKeyVal: <Buffer 31 5e 52 47 b1 b4 56 59 3b ce 2d fb 99 0a 44 cd 8e 3a 62 62 10 7f dd 42 42 7f 26 5c 29 d4 68 08>,
     absValidity: 2018-08-28T03:51:59.000Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer f0 6a 53 ee d2 18 a4 6e>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.14:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 21 0.38095238095238093 1535341978832
connected to auth! from local port 59372
received auth hello!
{ authId: 503, nonce: <Buffer bc 12 90 b7 94 4d ee 1f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ef e4 39 e7 3c 66 a0 b6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50300115,
  cipherKeyVal: <Buffer a2 13 7c f1 d0 fb 85 aa 68 ac d4 50 2d ff 99 14>,
  macKeyVal: <Buffer 5f 3a e7 df 28 ea 10 46 5c 2a f6 82 94 1c 01 25 8e 5d c9 63 53 74 ac f0 93 e2 5c 90 27 21 51 b5>,
  absValidity: 2018-08-28T03:52:59.059Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.14',
  serverPort: 22100,
  sessionKey: 
   { id: 50300115,
     cipherKeyVal: <Buffer a2 13 7c f1 d0 fb 85 aa 68 ac d4 50 2d ff 99 14>,
     macKeyVal: <Buffer 5f 3a e7 df 28 ea 10 46 5c 2a f6 82 94 1c 01 25 8e 5d c9 63 53 74 ac f0 93 e2 5c 90 27 21 51 b5>,
     absValidity: 2018-08-28T03:52:59.059Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 9c e6 23 9c 7b c3 f6 09>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.14:undefined
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
