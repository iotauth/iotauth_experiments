changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s504.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's504',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 76 38 ... > }
Handler: listening on port 22100
s504:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100059
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54138
received auth hello!
{ authId: 501, nonce: <Buffer 19 5c 2e 7e 4f 06 da 36> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer ce f9 1c 9b 36 4b ad 32>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 11 12 d9 2c 5a 87 39 0d e0 1b ef c6 5a d2 29 e9>,
  macKeyVal: <Buffer c7 19 f4 45 4c 6f f0 38 8f b7 46 2c 2d e6 95 4a f7 02 5b bf a8 48 5c 2b 3e 26 e5 dd ec 30 9d f2>,
  absValidity: 2018-08-27T05:29:58.227Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 01 9b d8 7a 49 4d 5c 91>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 01 9b d8 7a 49 4d 5c 91> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.67:58212',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100067
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54392
received auth hello!
{ authId: 501, nonce: <Buffer 32 7f 84 cc d6 90 67 d9> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f2 26 c7 08 fa b0 10 91>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 9a de 14 73 ed f4 5e 02>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 9a de 14 73 ed f4 5e 02> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.67:58466',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100075
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54662
received auth hello!
{ authId: 501, nonce: <Buffer ce 17 11 ad 8c 02 87 b0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 4a e0 2d 9f 88 80 dd 38>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer b9 de 63 9f fb 90 2b 88>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer b9 de 63 9f fb 90 2b 88> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.67:58736',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100083
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54932
received auth hello!
{ authId: 501, nonce: <Buffer 59 8f 43 1a b6 6d 67 47> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer b1 55 d4 46 c1 c8 75 51>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 7f f9 0b 96 69 4e d3 26>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 7f f9 0b 96 69 4e d3 26> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.67:59006',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100091
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 55202
received auth hello!
{ authId: 501, nonce: <Buffer ea a4 14 43 de 8f 2b 07> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 02 39 d8 e8 91 0a cd 55>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 97 57 cc 5d 10 58 f3 9a>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 97 57 cc 5d 10 58 f3 9a> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.67:59276',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100099
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 55472
received auth hello!
{ authId: 501, nonce: <Buffer b4 57 b6 ee 5b 93 47 39> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 74 00 23 bf 92 93 a8 6d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 28 30 d7 4d 51 fa 3a 41>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 28 30 d7 4d 51 fa 3a 41> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.67:59546',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100107
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 55742
received auth hello!
{ authId: 501, nonce: <Buffer e0 bf 8f 59 d3 1a a7 2e> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 10 ae 56 06 da f1 17 d2>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 60 61 2e 94 4c 0a 1a 80>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 60 61 2e 94 4c 0a 1a 80> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.67:59816',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200409
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200424
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 36834
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200439
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 37084
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 401, nonce: <Buffer fa 17 eb fe e6 df 2d 27> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200454
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200469
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 52040
received auth hello!
{ authId: 502, nonce: <Buffer 4b 97 97 f2 10 05 31 38> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth501',
     commonName: '10.0.0.4' },
  serial: '016579A30A2F',
  notBefore: 2018-08-27T04:25:52.000Z,
  notAfter: 2018-08-28T04:27:32.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '33:51:DA:47:DD:99:6A:B3:5B:22:4E:07:B8:2F:40:3E:8A:A1:DF:0E',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'B138D36BE53FEF7A4EAFB969AC06E51234F04819636E9BD1C18A274EF509C20F60425ECB70D73DBE38728E4C8AE5C9A51F6B212017E83DB7265ADE4EB91743FF00E6384C91216C08E24F877D4756852A1A006533657C2AD970B6694EAA6074DD788860A9BBCCF0D830F5A7FED589C63785576A172E75E8EA5C2AFC1B8563D3B27BB7450A9659E288F607AA1643255BB6082A7AF57221C9DB5DDE2AFA6C5D86E13162450B4905BD4511BE1D82F1A3D32974AE25E6317777B2B45BA251A2511FFC8EF6FAE19E1CFC5BEEC19ADFE72E99C553F36401DCCA304F5C309892EE68C67986CBBFB67CEC5666ADDA8CD6487848CF2EDC5C68B7924C91D54BBEC322B2C309',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5owovMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDExETAPBgNVBAMMCDEwLjAuMC40MB4XDTE4MDgy\nNzA0MjU1MloXDTE4MDgyODA0MjczMlowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCxONNr5T/vek6vuWmsBuUSNPBIGWNum9HBiidO9QnCD2BCXstw\n1z2+OHKOTIrlyaUfayEgF+g9tyZa3k65F0P/AOY4TJEhbAjiT4d9R1aFKhoAZTNl\nfCrZcLZpTqpgdN14iGCpu8zw2DD1p/7VicY3hVdqFy516OpcKvwbhWPTsnu3RQqW\nWeKI9geqFkMlW7YIKnr1ciHJ213eKvpsXYbhMWJFC0kFvUURvh2C8aPTKXSuJeYx\nd3eytFuiUaJRH/yO9vrhnhz8W+7Bmt/nLpnFU/NkAdzKME9cMJiS7mjGeYbLv7Z8\n7FZmrdqM1kh4SM8u3Fxot5JMkdVLvsMissMJAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAG/nd26Nl8Rqyu/kvPaeeYPxmlno08ZD\nTxk0bODd0lbipQ79XMiN30hKPS3S0tP3KIIGxk7s4TSsYpskvSKU1RPCNgs7f0X/\nCSd0zcLiFlepnnaEEoNCSPhK1CyfRLu4fGxxx7+PLSLiuZkts65JOJRp9fgcdZ4Y\nwr5q7I/RDBHTlYPOdl2BCoDpe4tYwHg6FP6yzy06yf31WsTQXOJTP1rEccTBNjB2\nJI8MC1+Oy7+xxggC3lFV7M0/ESgJI+6L1bVacW7yToijbB9Gk8YTi3xnTQTYZBAo\nj0Zxc/94PXCTDu8aChhb5ZtyWwffMjbSSbU24BefKgeDneU5ZS1CuyY=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
