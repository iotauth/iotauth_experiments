changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s501.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's501',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 72 44 ... > }
Handler: listening on port 22100
s501:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100056
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51434
received auth hello!
{ authId: 501, nonce: <Buffer 25 cf 33 e3 5a 72 9f 0d> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 60 9c d1 3e d3 2d 01 48>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer d4 eb 62 e5 70 0c 3f ee c9 0c 95 c0 90 2a f3 29>,
  macKeyVal: <Buffer 37 92 90 19 07 2d 66 d5 7d 81 dc 1d b9 f1 59 78 15 6e ae ca 59 97 e9 73 a6 3f 47 0e 70 18 ab 6a>,
  absValidity: 2018-08-27T05:29:41.691Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ad 00 ee a6 0a 95 73 ec>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer ad 00 ee a6 0a 95 73 ec> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.62:59060',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100064
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51662
received auth hello!
{ authId: 501, nonce: <Buffer f2 cd 44 42 08 42 61 d2> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c2 b2 8c 50 ee 9c ba a9>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer bc 82 8a 9b b5 3c 1a aa>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer bc 82 8a 9b b5 3c 1a aa> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.62:59286',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100072
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51932
received auth hello!
{ authId: 501, nonce: <Buffer 4b 5f ec 51 38 03 1b 67> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 37 50 35 50 6d b3 0f 65>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 19 6a ad 45 35 f3 f0 f5>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 19 6a ad 45 35 f3 f0 f5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.62:59556',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100080
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52202
received auth hello!
{ authId: 501, nonce: <Buffer 2e 1a d3 ea 3e 5a 32 ed> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ee e4 ad 91 c4 4a 35 bc>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 07 40 a3 16 33 ae 25 40>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 07 40 a3 16 33 ae 25 40> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.62:59826',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100088
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52472
received auth hello!
{ authId: 501, nonce: <Buffer bd ae cf 3a 74 cc 2e b3> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f4 81 18 b3 f3 d8 0a b2>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 71 68 14 38 44 d3 49 a9>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 71 68 14 38 44 d3 49 a9> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.62:60096',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100096
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52742
received auth hello!
{ authId: 501, nonce: <Buffer 6d de 9a e8 84 59 9d fb> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 6c 74 4d 30 0d e4 99 97>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 58 f9 cb df 85 66 03 e0>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 58 f9 cb df 85 66 03 e0> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.62:60366',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100104
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 53012
received auth hello!
{ authId: 501, nonce: <Buffer 51 07 5c cc 04 45 cf 75> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 94 4d 3a d3 f5 56 05 0f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 88 f2 80 fb ef bb a4 c8>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 88 f2 80 fb ef bb a4 c8> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.62:60636',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200406
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200421
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 53302
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200436
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 53562
received auth hello!
{ authId: 401, nonce: <Buffer 57 2e d2 39 80 0c 56 b4> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200451
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200466
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 49640
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 8b 69 03 8a 54 99 a1 30> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth501',
     commonName: '10.0.0.4' },
  serial: '016579A30A2F',
  notBefore: 2018-08-27T04:25:52.000Z,
  notAfter: 2018-08-28T04:27:32.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '33:51:DA:47:DD:99:6A:B3:5B:22:4E:07:B8:2F:40:3E:8A:A1:DF:0E',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'B138D36BE53FEF7A4EAFB969AC06E51234F04819636E9BD1C18A274EF509C20F60425ECB70D73DBE38728E4C8AE5C9A51F6B212017E83DB7265ADE4EB91743FF00E6384C91216C08E24F877D4756852A1A006533657C2AD970B6694EAA6074DD788860A9BBCCF0D830F5A7FED589C63785576A172E75E8EA5C2AFC1B8563D3B27BB7450A9659E288F607AA1643255BB6082A7AF57221C9DB5DDE2AFA6C5D86E13162450B4905BD4511BE1D82F1A3D32974AE25E6317777B2B45BA251A2511FFC8EF6FAE19E1CFC5BEEC19ADFE72E99C553F36401DCCA304F5C309892EE68C67986CBBFB67CEC5666ADDA8CD6487848CF2EDC5C68B7924C91D54BBEC322B2C309',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5owovMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDExETAPBgNVBAMMCDEwLjAuMC40MB4XDTE4MDgy\nNzA0MjU1MloXDTE4MDgyODA0MjczMlowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCxONNr5T/vek6vuWmsBuUSNPBIGWNum9HBiidO9QnCD2BCXstw\n1z2+OHKOTIrlyaUfayEgF+g9tyZa3k65F0P/AOY4TJEhbAjiT4d9R1aFKhoAZTNl\nfCrZcLZpTqpgdN14iGCpu8zw2DD1p/7VicY3hVdqFy516OpcKvwbhWPTsnu3RQqW\nWeKI9geqFkMlW7YIKnr1ciHJ213eKvpsXYbhMWJFC0kFvUURvh2C8aPTKXSuJeYx\nd3eytFuiUaJRH/yO9vrhnhz8W+7Bmt/nLpnFU/NkAdzKME9cMJiS7mjGeYbLv7Z8\n7FZmrdqM1kh4SM8u3Fxot5JMkdVLvsMissMJAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAG/nd26Nl8Rqyu/kvPaeeYPxmlno08ZD\nTxk0bODd0lbipQ79XMiN30hKPS3S0tP3KIIGxk7s4TSsYpskvSKU1RPCNgs7f0X/\nCSd0zcLiFlepnnaEEoNCSPhK1CyfRLu4fGxxx7+PLSLiuZkts65JOJRp9fgcdZ4Y\nwr5q7I/RDBHTlYPOdl2BCoDpe4tYwHg6FP6yzy06yf31WsTQXOJTP1rEccTBNjB2\nJI8MC1+Oy7+xxggC3lFV7M0/ESgJI+6L1bVacW7yToijbB9Gk8YTi3xnTQTYZBAo\nj0Zxc/94PXCTDu8aChhb5ZtyWwffMjbSSbU24BefKgeDneU5ZS1CuyY=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
