changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s405.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's405',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 77 49 42 41 41 4b 43 41 51 45 41 7a 62 ... > }
Handler: listening on port 22100
s405:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200055
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47798
received auth hello!
{ authId: 402, nonce: <Buffer dd ed 1f 03 a1 a0 10 f3> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 31 b9 ca 8a 82 7a 42 2a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer dd bd 08 2a 99 64 0d 91 98 c2 26 be 65 84 c8 45>,
  macKeyVal: <Buffer 5a 2d a4 d1 3e 78 31 d3 63 6d 11 56 7c f0 40 cf 0e dd 73 88 3d 96 67 c2 72 39 fa d0 93 c1 bc b0>,
  absValidity: 2018-08-27T05:28:59.414Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 9f 32 c4 ec 46 50 57 41>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 9f 32 c4 ec 46 50 57 41> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.49:47540',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200062
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47948
received auth hello!
{ authId: 402, nonce: <Buffer 11 79 f8 94 08 bc 14 e1> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 9b 73 d5 6b cb 01 9a 8a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ab fb aa d7 28 bb 9f 13>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ab fb aa d7 28 bb 9f 13> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.49:47690',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200069
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48202
received auth hello!
{ authId: 402, nonce: <Buffer ca f6 a8 c9 61 a4 d7 d5> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5b 64 8f 48 59 99 23 31>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5b 7a aa 6b a1 37 76 c3>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 5b 7a aa 6b a1 37 76 c3> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.49:47944',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200076
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48472
received auth hello!
{ authId: 402, nonce: <Buffer c9 18 75 95 5f 87 06 41> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer cf 5f a0 06 a0 da d3 ad>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 25 90 be 01 93 29 7c 1c>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 25 90 be 01 93 29 7c 1c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.49:48214',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200083
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48742
received auth hello!
{ authId: 402, nonce: <Buffer be 83 46 01 37 dd 5d b3> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 29 0a 4d ca b7 a0 cb a6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 40 e8 0f dd 4e f0 02 37>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 40 e8 0f dd 4e f0 02 37> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.49:48484',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200090
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 49012
received auth hello!
{ authId: 402, nonce: <Buffer 37 63 e6 70 3d 94 1d e5> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a5 09 89 c9 8e e8 63 13>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 98 1f 16 e9 55 dc 1e 7c>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 98 1f 16 e9 55 dc 1e 7c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.49:48754',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200097
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 49282
received auth hello!
{ authId: 402, nonce: <Buffer 76 5a 30 54 7b eb a4 57> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 7f 6e 48 f5 c0 76 06 6f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 93 ac 8f 5b 1b 2f 42 14>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 93 ac 8f 5b 1b 2f 42 14> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.49:49024',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200104
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 49552
received auth hello!
{ authId: 402, nonce: <Buffer 93 20 25 d8 eb fe 70 10> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer fa 69 af 1d 26 7d 11 05>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c5 78 7f 79 77 95 8f c1>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c5 78 7f 79 77 95 8f c1> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.49:49294',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100400
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100408
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 34290
received auth hello!
{ authId: 502, nonce: <Buffer ce 9f 38 1b 7d 7d aa fd> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100424
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 34580
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 89 30 e5 01 07 38 91 09> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100434
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100445
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 50908
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100456
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 6
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 51112
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 401, nonce: <Buffer 1a 35 e0 b9 1a 8a fa 2d> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth401',
     commonName: '10.0.1.1' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth402',
     commonName: '10.0.0.2' },
  serial: '016579A30508',
  notBefore: 2018-08-27T04:25:51.000Z,
  notAfter: 2018-08-28T04:27:31.000Z,
  subjectHash: 'de555cae',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '79:D7:F0:36:F5:63:C9:5F:2F:6C:10:F7:B5:4C:7F:0A:36:A9:97:CE',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'AF23BC17C526A7AFDABD10E11B69948936F06BDEC216730D0926F4729C3F53806C2812687248D00BE365D1DB11907B8C3441F9A9A7F0B913065F79BBEFB9605DD128C9B144B177076B7E46B92A3FA31511995B3D57F9BFA275EBEDA464AF403971A8925028BF43CC548AC9052D7E35AD851586AC0C4EA1FC7C755E22CB819A087D35C0E9C0DF733E9757F060E6AF797111A2B852A6191E6341A7CF678D8604077227A06289ADD8492928D5EECC3787C220575D0F755645359EFE007ECCC7BBCE9132761D1346C2B4F372E3F9A44DF760E0EDCCAC935454D03E6F2A22C1BFC15A4ABCAA38B7AB27FC12DF6127B9A5258B4BD00B1E6D28F03EEDEDAE39ABC5924F',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.1' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 401,
  host: '10.0.1.1',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5owUIMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg0MDIxETAPBgNVBAMMCDEwLjAuMC4yMB4XDTE4MDgy\nNzA0MjU1MVoXDTE4MDgyODA0MjczMVowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDQwMTERMA8GA1UEAwwIMTAuMC4xLjEwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCvI7wXxSanr9q9EOEbaZSJNvBr3sIWcw0JJvRynD9TgGwoEmhy\nSNAL42XR2xGQe4w0Qfmpp/C5EwZfebvvuWBd0SjJsUSxdwdrfka5Kj+jFRGZWz1X\n+b+idevtpGSvQDlxqJJQKL9DzFSKyQUtfjWthRWGrAxOofx8dV4iy4GaCH01wOnA\n33M+l1fwYOaveXERorhSphkeY0Gnz2eNhgQHciegYomt2EkpKNXuzDeHwiBXXQ91\nVkU1nv4AfszHu86RMnYdE0bCtPNy4/mkTfdg4O3MrJNUVNA+byoiwb/BWkq8qji3\nqyf8Et9hJ7mlJYtL0AsebSjwPu3trjmrxZJPAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQEwDQYJKoZIhvcNAQELBQADggEBAD1utwYa5+xnllujS5dNOdoosfgaJAEl\nlQNGOFbYHbYFwyjppfapHpodKI5w+ThXBhVDDp9ZfzMzSptRpO7i+b7t1fmocUdT\nTbBXZ+QdPnEFUVnDK3Nqko/Bitsroyfrh83XfNGni4hsWihfR1LTbasb6Z+oEpKT\n+SVOCbrulTjuzGTWwLh6gcomgh9RYgy3/6qh3sRadHEn9nhWqgBo+i64otcKtozN\nzFswSGMIe2L76I+gi2JSLAR5DQ1sIGTsh46EnbiViYCjcWCpNc2vpyC1uHBgwIBF\ns+8FN/dpf9fOzPqIS1BXjV2w/BSYhWnMpKEIjglpASpBjWVarQoxIes=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
