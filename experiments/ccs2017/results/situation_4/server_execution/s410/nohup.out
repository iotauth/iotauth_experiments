changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s410.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's410',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 67 49 42 41 41 4b 43 41 51 45 41 38 4e ... > }
Handler: listening on port 22100
s410:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200004
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 45902
received auth hello!
{ authId: 402, nonce: <Buffer dd 90 0e 5d d9 23 e6 28> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 7e ee 6e 21 8b 48 8d b7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 2d f4 3c a0 e4 f7 97 35 19 4d d4 3f 2a bf a5 2c>,
  macKeyVal: <Buffer d8 7c a6 1b 7a de 06 7b 29 13 6d 15 ca 93 b0 ab 4d fd 71 05 85 ca 83 5d e9 d0 19 b8 6a 41 0e da>,
  absValidity: 2018-08-27T04:33:06.977Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 46 59 8e 8c a2 28 cb ca>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 46 59 8e 8c a2 28 cb ca> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.53:37330',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200011
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46114
received auth hello!
{ authId: 402, nonce: <Buffer a1 7d 1b 0b a1 2b e2 eb> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 36 9b 67 8b 88 27 3d a9>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ca c6 b2 7c e8 34 20 70>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ca c6 b2 7c e8 34 20 70> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.53:37542',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200018
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46384
received auth hello!
{ authId: 402, nonce: <Buffer 3a 08 ed f8 d0 6f 1e 4c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 4e 3e f5 6e 10 87 18 4c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 76 69 04 73 b0 9a 97 9f>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 76 69 04 73 b0 9a 97 9f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.53:37812',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200025
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46654
received auth hello!
{ authId: 402, nonce: <Buffer 0c 5f 91 a2 61 f8 5a 74> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a6 e4 be 5a 98 b4 7a 8a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c5 38 34 ae e4 b6 2c eb>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c5 38 34 ae e4 b6 2c eb> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.53:38082',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200032
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46924
received auth hello!
{ authId: 402, nonce: <Buffer 20 d7 e9 c9 62 92 d0 5f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 11 99 7f d2 8b 7a db 78>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d2 e9 fa 2f 6a d3 d3 1f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d2 e9 fa 2f 6a d3 d3 1f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.53:38352',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200039
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47194
received auth hello!
{ authId: 402, nonce: <Buffer 90 90 7d 6a 7d 5f 08 4c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer d8 19 ed 20 63 33 68 b6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 22 40 41 ae 1e 06 25 fe>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 22 40 41 ae 1e 06 25 fe> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.53:38622',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200046
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47464
received auth hello!
{ authId: 402, nonce: <Buffer 82 87 65 36 29 87 d5 c2> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 08 9f ad 24 22 57 5f bd>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c7 0d 4c 6c ac db 0d ea>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c7 0d 4c 6c ac db 0d ea> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.53:38892',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200053
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47734
received auth hello!
{ authId: 402, nonce: <Buffer 91 ea 6e e8 1a 71 a7 75> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5c 1d d1 f4 ae fe 62 fe>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 21 86 d7 86 19 ef 06 5a>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 21 86 d7 86 19 ef 06 5a> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.53:39162',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300077
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300087
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 46778
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 37 0f 6f 86 65 ac d2 31> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300097
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 47028
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
received auth hello!
{ authId: 502, nonce: <Buffer 45 c1 0f b8 ec 1e 6b ec> }
failure in migration to another Auth : migrationFailureCount: 3
Handler: Error in server - details: Error occurred in migration request: Error: write after end
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300107
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.4:21100
disconnected from auth
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Connection with Auth timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 3
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300117
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 51014
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
