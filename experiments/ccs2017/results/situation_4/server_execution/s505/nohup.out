changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s505.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's505',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 77 6b ... > }
Handler: listening on port 22100
s505:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100004
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 55880
received auth hello!
{ authId: 501, nonce: <Buffer e5 4d e6 5d fc 83 85 48> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 65 01 23 28 ee 5a 08 94>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 72 8e 33 59 b7 b5 c1 b1 be f4 b5 a2 b1 98 13 90>,
  macKeyVal: <Buffer 49 cb af 9e 45 7c 0a 5a 98 5a f1 83 45 1d ec 11 c9 0b 2f 9b fb c1 9f 3a 2a bc 15 30 3a 1b 3a d5>,
  absValidity: 2018-08-27T04:33:54.633Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 62 af 13 82 3b 35 64 1e>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 62 af 13 82 3b 35 64 1e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.68:42480',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100005
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 55892
received auth hello!
{ authId: 501, nonce: <Buffer 9a 6d e6 5e 64 cf 3b 71> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 49 bc 4d a4 1b a2 44 c1>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 95 c1 ae f9 16 dc 04 77>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 95 c1 ae f9 16 dc 04 77> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.69:50832',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100012
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56140
received auth hello!
{ authId: 501, nonce: <Buffer d5 64 49 09 45 af 6d 67> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ae 9c 23 c9 47 0b 43 c5>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 44 5d c4 6c 41 1a fa cf>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 44 5d c4 6c 41 1a fa cf> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.68:42740',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100013
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56158
received auth hello!
{ authId: 501, nonce: <Buffer ee 1e 04 5f 3a d3 78 64> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 81 c3 38 be 3c e9 f6 3c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 19 b1 20 b1 45 b4 a0 06>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 19 b1 20 b1 45 b4 a0 06> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.69:51098',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100020
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56410
received auth hello!
{ authId: 501, nonce: <Buffer ec 4e 40 2d 03 ab 07 6a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 12 05 0a b9 1b 44 53 ae>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 13 58 b2 19 28 03 5c 8f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 13 58 b2 19 28 03 5c 8f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.68:43010',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100021
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56428
received auth hello!
{ authId: 501, nonce: <Buffer 22 30 1e 1e 1a 6b f7 04> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 0e d3 04 a4 b7 fa c4 63>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 73 b4 2c 80 2e 22 3e 9f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 73 b4 2c 80 2e 22 3e 9f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.69:51368',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100028
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56680
received auth hello!
{ authId: 501, nonce: <Buffer fa d1 4f fb 0b aa 9e 53> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ed 50 19 66 0d 15 62 0d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d6 fd f4 ee 5a 5f 39 ed>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d6 fd f4 ee 5a 5f 39 ed> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.68:43280',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100029
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56698
received auth hello!
{ authId: 501, nonce: <Buffer b3 b2 48 8e db 00 33 7c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 05 d1 8b 36 86 39 a3 e4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d5 af 8e 28 7a 69 43 ff>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d5 af 8e 28 7a 69 43 ff> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.69:51638',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100036
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56950
received auth hello!
{ authId: 501, nonce: <Buffer 32 93 51 da 07 23 b5 53> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 0f 71 e3 52 12 c5 98 3f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e2 a6 b0 87 d3 59 2a d2>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e2 a6 b0 87 d3 59 2a d2> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.68:43550',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100037
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56968
received auth hello!
{ authId: 501, nonce: <Buffer 11 03 d3 16 a3 35 e9 55> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c0 5e 3f 05 68 5e 65 39>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 16 b9 8c 49 5c 50 7f 43>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 16 b9 8c 49 5c 50 7f 43> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.69:51908',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100044
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57220
received auth hello!
{ authId: 501, nonce: <Buffer aa ae 02 41 b0 55 91 8a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer b8 e5 b7 77 bd fd eb 5c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 0c 43 d8 c2 f2 4d be 6e>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 0c 43 d8 c2 f2 4d be 6e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 10,
  remoteAddress: '::ffff:10.0.1.68:43820',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 10 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 10 }
specified socketID: 10
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100045
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57238
received auth hello!
{ authId: 501, nonce: <Buffer 87 05 a5 86 e2 44 b5 3a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer e7 6c 78 30 d6 3e 04 47>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 12 b0 ed ac 1c df c0 af>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 12 b0 ed ac 1c df c0 af> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 11,
  remoteAddress: '::ffff:10.0.1.69:52178',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 11 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 11 }
specified socketID: 11
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #10 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100052
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57490
received auth hello!
{ authId: 501, nonce: <Buffer af 51 1c 5b 63 06 06 57> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 14 33 58 5a 74 0a ac 9d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 25 50 a3 51 5e 69 47 4a>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 25 50 a3 51 5e 69 47 4a> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 12,
  remoteAddress: '::ffff:10.0.1.68:44090',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 12 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 12 }
specified socketID: 12
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #11 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100053
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57508
received auth hello!
{ authId: 501, nonce: <Buffer 4e 36 58 3d 4a 5b e6 e4> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 86 43 17 ba 27 04 76 3e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f3 78 08 fc b0 7b 86 13>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f3 78 08 fc b0 7b 86 13> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 13,
  remoteAddress: '::ffff:10.0.1.69:52448',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 13 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 13 }
specified socketID: 13
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #12 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200092
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #13 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200093
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
Handler: Error in server - details: handshake2 timed out...
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 60380
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 401, nonce: <Buffer 9a 7f 18 38 a4 70 63 d1> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200107
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 60604
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200108
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
Handler: Error in server - details: handshake2 timed out...
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 60624
received auth hello!
{ authId: 401, nonce: <Buffer dc ef 5f d6 fc 04 93 a4> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 3
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200122
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200123
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
failure in connection with Auth : authFailureCount: 6
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 3
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 4
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200137
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 7
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200138
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51554
received auth hello!
{ authId: 502, nonce: <Buffer 59 dc 6f e9 e9 20 15 c3> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth501',
     commonName: '10.0.0.4' },
  serial: '0165796FA793',
  notBefore: 2018-08-27T03:29:45.000Z,
  notAfter: 2018-08-28T03:31:25.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '28:4D:FE:20:04:D7:86:93:50:8F:46:8A:7B:CA:60:2F:B5:59:40:2A',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'B138D36BE53FEF7A4EAFB969AC06E51234F04819636E9BD1C18A274EF509C20F60425ECB70D73DBE38728E4C8AE5C9A51F6B212017E83DB7265ADE4EB91743FF00E6384C91216C08E24F877D4756852A1A006533657C2AD970B6694EAA6074DD788860A9BBCCF0D830F5A7FED589C63785576A172E75E8EA5C2AFC1B8563D3B27BB7450A9659E288F607AA1643255BB6082A7AF57221C9DB5DDE2AFA6C5D86E13162450B4905BD4511BE1D82F1A3D32974AE25E6317777B2B45BA251A2511FFC8EF6FAE19E1CFC5BEEC19ADFE72E99C553F36401DCCA304F5C309892EE68C67986CBBFB67CEC5666ADDA8CD6487848CF2EDC5C68B7924C91D54BBEC322B2C309',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5b6eTMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDExETAPBgNVBAMMCDEwLjAuMC40MB4XDTE4MDgy\nNzAzMjk0NVoXDTE4MDgyODAzMzEyNVowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCxONNr5T/vek6vuWmsBuUSNPBIGWNum9HBiidO9QnCD2BCXstw\n1z2+OHKOTIrlyaUfayEgF+g9tyZa3k65F0P/AOY4TJEhbAjiT4d9R1aFKhoAZTNl\nfCrZcLZpTqpgdN14iGCpu8zw2DD1p/7VicY3hVdqFy516OpcKvwbhWPTsnu3RQqW\nWeKI9geqFkMlW7YIKnr1ciHJ213eKvpsXYbhMWJFC0kFvUURvh2C8aPTKXSuJeYx\nd3eytFuiUaJRH/yO9vrhnhz8W+7Bmt/nLpnFU/NkAdzKME9cMJiS7mjGeYbLv7Z8\n7FZmrdqM1kh4SM8u3Fxot5JMkdVLvsMissMJAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAGPh9ZnSjprQKYeCkVdeTsaHZAXxL0Pg\nMmj4X6bce1rs2wQGWxTN85kGlS97uDLCZ65sKGSaVDHBoG3SjBwqVFjdzjetWjIK\nCbdrd76/CpHMpEcQXaykLJMcpZIqEQ5qlTf89v7Vf6qo9sxAAP2pE5IinTPQyrZl\nAAEG9oSeEPJ0JwLbgQSZT5OiOuw3fNI4IwVMEwRiOD4gGMq2I++PDuZ2xHovXLgr\nTVRjrAWjF2rjBQ1Gz4jwm5PXu3H7r5aGrQampI1Nl4KrPwN3PlX9ujlICNbYJtNb\n5FP+iZOgaYB+MPoiuiH9/WzlRRGPgHP44V6S4dc23S6/NmGZpb47tm8=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200152
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51808
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer d8 08 94 d6 7d 89 c2 95> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 50 a6 83 a1 27 47 72 7c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 03 1e 33 5a ec 6e 3c 8f d5 33 cb eb 8f 24 cc fc>,
  macKeyVal: <Buffer 2e 8b e9 20 cc 95 f3 ec 48 74 63 b7 be cc 67 64 18 f4 cd ef 25 52 77 e2 ae 2a 9b dc c5 7b 1c e4>,
  absValidity: 2018-08-27T04:50:03.928Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer cf 76 73 c3 c5 b7 6c f9>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer cf 76 73 c3 c5 b7 6c f9> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 14,
  remoteAddress: '::ffff:10.0.1.68:46376',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 14 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 14 }
specified socketID: 14
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200153
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51862
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #14 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200163
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52070
received auth hello!
{ authId: 502, nonce: <Buffer 06 a0 8b da 2d 7a 72 4a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer d3 2d 02 0d e4 2c 20 bb>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 2d a4 82 0a 55 9c 97 62>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 2d a4 82 0a 55 9c 97 62> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 15,
  remoteAddress: '::ffff:10.0.1.68:46634',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 15 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 15 }
specified socketID: 15
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200178
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52404
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #15 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200179
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52408
received auth hello!
{ authId: 502, nonce: <Buffer 1c 7f 02 ac 94 d3 1b 9b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 32 f7 ac a5 12 4b 4e 61>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 00 4d d1 81 5c ca 71 c7>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 00 4d d1 81 5c ca 71 c7> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 16,
  remoteAddress: '::ffff:10.0.1.68:46976',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 16 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 16 }
specified socketID: 16
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 37 5d 51 c7 af bf 30 59> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer de 97 bf 7a d8 d7 e7 11>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d7 06 9f c5 b1 5f 5c 8e>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer d7 06 9f c5 b1 5f 5c 8e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 17,
  remoteAddress: '::ffff:10.0.1.69:55312',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 17 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 17 }
specified socketID: 17
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #16 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200189
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52578
received auth hello!
{ authId: 502, nonce: <Buffer 2d 43 f8 e8 ae 23 5f 72> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 2a 20 be 07 a6 45 bf 56>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e8 14 1c df ed 56 6a 63>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e8 14 1c df ed 56 6a 63> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 18,
  remoteAddress: '::ffff:10.0.1.68:47146',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 18 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 18 }
specified socketID: 18
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #17 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200192
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52666
received auth hello!
{ authId: 502, nonce: <Buffer 1b d9 dc 1c 04 9a 8b 2f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 66 aa 21 6b 77 c3 a5 a8>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c4 79 9b d3 ec 7a a9 89>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer c4 79 9b d3 ec 7a a9 89> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 19,
  remoteAddress: '::ffff:10.0.1.69:55574',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 19 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 19 }
specified socketID: 19
received auth hello!
{ authId: 502, nonce: <Buffer 51 4f 33 24 bb 22 8e b6> }
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: write after end
disconnected from auth
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #18 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200202
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52832
Handler: Error in server - details: handshake2 timed out...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
