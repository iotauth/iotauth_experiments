changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for autoClient: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Clients/c417.config
initializing...
current parameters: { numKeysPerRequest: 3,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 'c417',
  group: 'Clients',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 67 49 42 41 41 4b 43 41 51 45 41 6f 39 ... > }
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 0 1 0 1535340804137
connected to auth! from local port 38896
received auth hello!
{ authId: 403, nonce: <Buffer 9c 1e 98 f5 4f da d1 be> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 7a f2 aa 69 8e 50 d8 6a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 9d 44 26 e4 45 a5 4c 28 ea 89 77 76 0d 89 c2 4b>,
  macKeyVal: <Buffer 0f 5a 2d 54 28 e6 b6 43 70 3a c9 96 2a fd 98 89 87 2b 50 cb 90 d5 7d 37 5e 11 38 82 62 b5 51 38>,
  absValidity: 2018-08-27T04:33:24.296Z }
received 1 keys
currentSessionKey: [object Object]
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300003,
  cipherKeyVal: <Buffer 4e 38 e7 e7 6f 32 7a 8b 89 53 e2 a4 c8 90 b0 e7>,
  macKeyVal: <Buffer 03 48 2b b8 12 48 99 be 69 cb 62 40 7e 9e 34 3f 77 40 ff 59 62 b0 8f af 96 9e 80 b6 75 a1 a9 7f>,
  absValidity: 2018-08-28T03:33:24.295Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300003,
     cipherKeyVal: <Buffer 4e 38 e7 e7 6f 32 7a 8b 89 53 e2 a4 c8 90 b0 e7>,
     macKeyVal: <Buffer 03 48 2b b8 12 48 99 be 69 cb 62 40 7e 9e 34 3f 77 40 ff 59 62 b0 8f af 96 9e 80 b6 75 a1 a9 7f>,
     absValidity: 2018-08-28T03:33:24.295Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
disconnected from auth
chosen nonce: <Buffer c2 3a cf 0e b0 89 9b 70>
switching to HANDSHAKE_1_SENT
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:33:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 1 1 1 1535340805889
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 1 2 0.5 1535340864170
connected to auth! from local port 39136
received auth hello!
{ authId: 403, nonce: <Buffer 7c 87 fb 35 8b 8d 0b 19> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 84 d9 90 3f 76 b0 e0 12>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300009,
  cipherKeyVal: <Buffer 5e 87 15 c4 76 a7 e6 31 fe 22 c4 42 27 0f fd b2>,
  macKeyVal: <Buffer 12 02 97 ae f2 9b cc 91 43 a9 02 f1 f0 90 63 73 c9 fa 9f df a7 53 0f 76 ca 17 dc b5 02 c8 30 b3>,
  absValidity: 2018-08-28T03:34:24.329Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300009,
     cipherKeyVal: <Buffer 5e 87 15 c4 76 a7 e6 31 fe 22 c4 42 27 0f fd b2>,
     macKeyVal: <Buffer 12 02 97 ae f2 9b cc 91 43 a9 02 f1 f0 90 63 73 c9 fa 9f df a7 53 0f 76 ca 17 dc b5 02 c8 30 b3>,
     absValidity: 2018-08-28T03:34:24.329Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer e0 64 d9 12 31 58 64 99>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:34:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 2 2 1 1535340865891
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 2 3 0.6666666666666666 1535340924205
connected to auth! from local port 39406
received auth hello!
{ authId: 403, nonce: <Buffer 3a 9a 19 ed 1c 27 7e 78> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 9d 3d 5e 1e d4 df f9 3e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300015,
  cipherKeyVal: <Buffer bd 92 b4 da 0b 16 44 e1 83 92 ca 13 d9 49 e7 50>,
  macKeyVal: <Buffer 39 a0 57 ab 37 11 05 45 ba 07 7a c9 f0 21 9b be f9 4e 52 79 52 9c 46 3b 58 3f e6 69 f2 2e 55 e8>,
  absValidity: 2018-08-28T03:35:24.359Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300015,
     cipherKeyVal: <Buffer bd 92 b4 da 0b 16 44 e1 83 92 ca 13 d9 49 e7 50>,
     macKeyVal: <Buffer 39 a0 57 ab 37 11 05 45 ba 07 7a c9 f0 21 9b be f9 4e 52 79 52 9c 46 3b 58 3f e6 69 f2 2e 55 e8>,
     absValidity: 2018-08-28T03:35:24.359Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 4a f6 79 75 93 d8 15 46>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:35:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 3 3 1 1535340925989
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 3 4 0.75 1535340984246
connected to auth! from local port 39676
received auth hello!
{ authId: 403, nonce: <Buffer e7 1b 4e 85 c9 ea 4c 7a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 13 ae f2 56 79 13 e6 24>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300021,
  cipherKeyVal: <Buffer 8a 83 3c 75 3b b7 2b 3f 89 06 a8 2d 56 c1 75 eb>,
  macKeyVal: <Buffer 4d 1c a2 df 0b 81 68 18 3c b6 cb ac e6 ad dd 91 d9 44 31 f1 10 29 cb 52 96 56 1f 2d 0d f1 ff 84>,
  absValidity: 2018-08-28T03:36:24.413Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300021,
     cipherKeyVal: <Buffer 8a 83 3c 75 3b b7 2b 3f 89 06 a8 2d 56 c1 75 eb>,
     macKeyVal: <Buffer 4d 1c a2 df 0b 81 68 18 3c b6 cb ac e6 ad dd 91 d9 44 31 f1 10 29 cb 52 96 56 1f 2d 0d f1 ff 84>,
     absValidity: 2018-08-28T03:36:24.413Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 5d 86 ec 38 63 93 96 2f>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:36:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 4 4 1 1535340985905
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 4 5 0.8 1535341044304
connected to auth! from local port 39946
received auth hello!
{ authId: 403, nonce: <Buffer fc 26 f8 f6 a7 0f a4 99> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 69 3f e9 b0 a3 99 2b eb>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300027,
  cipherKeyVal: <Buffer ac 9a bb 90 bd e2 af a8 48 a2 80 f6 3a a2 a7 2a>,
  macKeyVal: <Buffer c0 e2 76 8b 77 90 97 66 0c dc 2e ee ee cd 0a 7b 40 b5 72 bd 02 86 1f e4 bb f7 28 ff 84 53 66 46>,
  absValidity: 2018-08-28T03:37:24.439Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300027,
     cipherKeyVal: <Buffer ac 9a bb 90 bd e2 af a8 48 a2 80 f6 3a a2 a7 2a>,
     macKeyVal: <Buffer c0 e2 76 8b 77 90 97 66 0c dc 2e ee ee cd 0a 7b 40 b5 72 bd 02 86 1f e4 bb f7 28 ff 84 53 66 46>,
     absValidity: 2018-08-28T03:37:24.439Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer ce 0a fb 52 66 b3 dc 73>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:37:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 5 5 1 1535341045979
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 5 6 0.8333333333333334 1535341104363
connected to auth! from local port 40216
received auth hello!
{ authId: 403, nonce: <Buffer 2d 6c 47 98 33 68 45 42> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5a 38 3b bf cd 92 75 80>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300033,
  cipherKeyVal: <Buffer ce 74 ce 46 4d a1 5d c1 a6 ea 70 94 d1 fb 4c 16>,
  macKeyVal: <Buffer 25 cb 6e bc ff d1 67 5a 93 8b 77 cc 7f 9b 04 92 0d ac 2f 93 c5 49 85 08 d8 c5 74 77 34 73 b6 4b>,
  absValidity: 2018-08-28T03:38:24.515Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300033,
     cipherKeyVal: <Buffer ce 74 ce 46 4d a1 5d c1 a6 ea 70 94 d1 fb 4c 16>,
     macKeyVal: <Buffer 25 cb 6e bc ff d1 67 5a 93 8b 77 cc 7f 9b 04 92 0d ac 2f 93 c5 49 85 08 d8 c5 74 77 34 73 b6 4b>,
     absValidity: 2018-08-28T03:38:24.515Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 1c 2c 0e c6 75 d9 2f f5>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:38:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 6 6 1 1535341106067
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 6 7 0.8571428571428571 1535341164401
connected to auth! from local port 40486
received auth hello!
{ authId: 403, nonce: <Buffer 54 e5 3e 25 76 1c 5d 5c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a2 36 ae ad a4 47 58 82>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300039,
  cipherKeyVal: <Buffer 0f dd 56 35 67 c7 31 67 03 55 d2 29 fa ef 0d 07>,
  macKeyVal: <Buffer 99 e0 09 72 22 a0 49 cc bb 08 f5 0f f3 4b 14 f5 3f 66 ea 01 4e 7b fe d9 9e ae d0 4c fd ab 3f 0d>,
  absValidity: 2018-08-28T03:39:24.521Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300039,
     cipherKeyVal: <Buffer 0f dd 56 35 67 c7 31 67 03 55 d2 29 fa ef 0d 07>,
     macKeyVal: <Buffer 99 e0 09 72 22 a0 49 cc bb 08 f5 0f f3 4b 14 f5 3f 66 ea 01 4e 7b fe d9 9e ae d0 4c fd ab 3f 0d>,
     absValidity: 2018-08-28T03:39:24.521Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 80 45 80 39 68 2a 84 76>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:39:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 7 7 1 1535341166109
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 7 8 0.875 1535341224460
connected to auth! from local port 40752
received auth hello!
{ authId: 403, nonce: <Buffer 21 e3 db 0d ef 9f 46 15> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 12 a7 54 0c 8a ae 96 42>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40300045,
  cipherKeyVal: <Buffer 17 3a 20 27 1f 26 7d 9d 5a 2b 34 61 14 00 49 50>,
  macKeyVal: <Buffer ee c6 fd 1d 30 f9 89 b8 bc 3c 75 16 e5 59 0d 8d 3a 80 9a 94 3f 26 45 d1 8d 3d 58 7b 98 31 05 b4>,
  absValidity: 2018-08-28T03:40:24.610Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40300045,
     cipherKeyVal: <Buffer 17 3a 20 27 1f 26 7d 9d 5a 2b 34 61 14 00 49 50>,
     macKeyVal: <Buffer ee c6 fd 1d 30 f9 89 b8 bc 3c 75 16 e5 59 0d 8d 3a 80 9a 94 3f 26 45 d1 8d 3d 58 7b 98 31 05 b4>,
     absValidity: 2018-08-28T03:40:24.610Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 06 a1 1d 39 6b de 69 07>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Mon Aug 27 2018 03:40:25 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 8 8 1 1535341226168
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 9 0.8888888888888888 1535341284518
failure in connection with Auth : authFailureCount: 1
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 10 0.8 1535341344528
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
connected to auth! from local port 48942
received auth hello!
{ authId: 503, nonce: <Buffer 2f e7 d7 31 fc ff 38 d5> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 11 0.7272727272727273 1535341404538
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
connected to auth! from local port 49162
received auth hello!
{ authId: 503, nonce: <Buffer 07 4a db a4 fa b3 0e 74> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 12 0.6666666666666666 1535341464548
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.7:21100
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 13 0.6153846153846154 1535341524556
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 14 0.5714285714285714 1535341584563
failure in connection with Auth : authFailureCount: 6
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 2
to: 3
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
connected to auth! from local port 56872
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 15 0.5333333333333333 1535341644570
failure in connection with Auth : authFailureCount: 7
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.3:21100
connected to auth! from local port 57114
received auth hello!
{ authId: 401, nonce: <Buffer 62 00 9c b4 ef 8a af f1> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth401',
     commonName: '10.0.1.1' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth403',
     commonName: '10.0.0.3' },
  serial: '0165796FA51A',
  notBefore: 2018-08-27T03:29:44.000Z,
  notAfter: 2018-08-28T03:31:24.000Z,
  subjectHash: 'de555cae',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '98:88:FD:EF:1C:98:1D:FC:2B:AA:27:48:1B:22:2F:62:56:4C:6C:26',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'AF23BC17C526A7AFDABD10E11B69948936F06BDEC216730D0926F4729C3F53806C2812687248D00BE365D1DB11907B8C3441F9A9A7F0B913065F79BBEFB9605DD128C9B144B177076B7E46B92A3FA31511995B3D57F9BFA275EBEDA464AF403971A8925028BF43CC548AC9052D7E35AD851586AC0C4EA1FC7C755E22CB819A087D35C0E9C0DF733E9757F060E6AF797111A2B852A6191E6341A7CF678D8604077227A06289ADD8492928D5EECC3787C220575D0F755645359EFE007ECCC7BBCE9132761D1346C2B4F372E3F9A44DF760E0EDCCAC935454D03E6F2A22C1BFC15A4ABCAA38B7AB27FC12DF6127B9A5258B4BD00B1E6D28F03EEDEDAE39ABC5924F',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.1' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 401,
  host: '10.0.1.1',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV5b6UaMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg0MDMxETAPBgNVBAMMCDEwLjAuMC4zMB4XDTE4MDgy\nNzAzMjk0NFoXDTE4MDgyODAzMzEyNFowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDQwMTERMA8GA1UEAwwIMTAuMC4xLjEwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCvI7wXxSanr9q9EOEbaZSJNvBr3sIWcw0JJvRynD9TgGwoEmhy\nSNAL42XR2xGQe4w0Qfmpp/C5EwZfebvvuWBd0SjJsUSxdwdrfka5Kj+jFRGZWz1X\n+b+idevtpGSvQDlxqJJQKL9DzFSKyQUtfjWthRWGrAxOofx8dV4iy4GaCH01wOnA\n33M+l1fwYOaveXERorhSphkeY0Gnz2eNhgQHciegYomt2EkpKNXuzDeHwiBXXQ91\nVkU1nv4AfszHu86RMnYdE0bCtPNy4/mkTfdg4O3MrJNUVNA+byoiwb/BWkq8qji3\nqyf8Et9hJ7mlJYtL0AsebSjwPu3trjmrxZJPAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQEwDQYJKoZIhvcNAQELBQADggEBAJ3uI4NDdHg5I0Y6+batPOiBrh6sG7oB\nfV1GWxTzXQSUp6YELwPkXG9AjZYxYHDNTdG7vO+cFLTZCWtyoKSDmRQpyQNguz6o\nMLcSvzdCITJHVtSdr1k0wosEehwzEoXPPcx/KPy5E53SYaKk8ev0EFbt8Ibid7VE\niJw1S6Di9em4ST51DApi6cw0amzMJCXV0MRLKuaTFnF/SdzWarup9Px0AdhiCZJT\nSHYH2qH+DuPwvF1F/ArjkYjF3jUXBZmZyZqhNgoMvzDr46ciMXfAz5W1wCa/wYgZ\nEaL6eBEul6PeAOhrKFPU1OGswkrkaC2qFOOUJohuo/ShEbsi5v7q0YA=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 3
to: 4
disconnected from auth
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 16 0.5 1535341704580
connected to auth! from local port 57352
received auth hello!
{ authId: 401, nonce: <Buffer 26 9a 4b f2 ac 80 be c8> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer e0 dc a8 b5 8d 51 21 8b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer c2 ee cd 3a 42 e0 ae d6 16 b4 52 22 c5 f1 c7 85>,
  macKeyVal: <Buffer ab 82 5e e9 16 0d 61 60 ea 4e 27 43 69 8d 3e 56 2e 21 3f aa a0 f4 ae 91 55 8f 7c c0 06 71 d0 32>,
  absValidity: 2018-08-27T04:48:24.825Z }
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100116,
  cipherKeyVal: <Buffer d4 b5 e3 4c f9 f1 8d 3b 4a cc eb 94 0d a3 72 c9>,
  macKeyVal: <Buffer a2 f8 dc 35 d6 64 8d c8 8d f9 24 f7 b4 e2 cb 48 f9 8b b4 a9 43 8d d9 38 10 c6 bd 6c 70 d4 08 e3>,
  absValidity: 2018-08-28T03:48:24.825Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100116,
     cipherKeyVal: <Buffer d4 b5 e3 4c f9 f1 8d 3b 4a cc eb 94 0d a3 72 c9>,
     macKeyVal: <Buffer a2 f8 dc 35 d6 64 8d c8 8d f9 24 f7 b4 e2 cb 48 f9 8b b4 a9 43 8d d9 38 10 c6 bd 6c 70 d4 08 e3>,
     absValidity: 2018-08-28T03:48:24.825Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
disconnected from auth
chosen nonce: <Buffer 5b 7b bf 60 96 7c 10 ac>
switching to HANDSHAKE_1_SENT
Handler: secure connection with the server closed.
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 17 0.47058823529411764 1535341764590
connected to auth! from local port 57608
received auth hello!
{ authId: 401, nonce: <Buffer 05 0d 54 3d 1c 57 01 f9> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer dc ce 99 ab 8d 74 73 d1>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100129,
  cipherKeyVal: <Buffer fc 98 32 76 ee b1 32 c4 2a e4 d1 4b 85 1e 58 ba>,
  macKeyVal: <Buffer 7d 0e ea 79 75 5e 87 80 14 9f 1b 7f f0 3d 7b b2 78 0e cf c5 d0 41 2c cc f8 ef c1 72 33 4f be 7c>,
  absValidity: 2018-08-28T03:49:24.740Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100129,
     cipherKeyVal: <Buffer fc 98 32 76 ee b1 32 c4 2a e4 d1 4b 85 1e 58 ba>,
     macKeyVal: <Buffer 7d 0e ea 79 75 5e 87 80 14 9f 1b 7f f0 3d 7b b2 78 0e cf c5 d0 41 2c cc f8 ef c1 72 33 4f be 7c>,
     absValidity: 2018-08-28T03:49:24.740Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 23 16 f6 d6 86 19 e8 90>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 18 0.4444444444444444 1535341824599
connected to auth! from local port 57866
received auth hello!
{ authId: 401, nonce: <Buffer dd 3b c5 c2 ba 18 a9 93> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer dc b9 e0 34 13 12 63 4f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100143,
  cipherKeyVal: <Buffer 78 3a 16 40 05 32 32 5d a9 df 64 f8 fe 55 61 64>,
  macKeyVal: <Buffer 2f 27 b1 e7 85 39 bd f5 e0 b9 2f 91 69 f3 ab c6 1a 4f 14 fc af 66 be 11 33 0b e7 b1 b0 40 c8 89>,
  absValidity: 2018-08-28T03:50:24.772Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100143,
     cipherKeyVal: <Buffer 78 3a 16 40 05 32 32 5d a9 df 64 f8 fe 55 61 64>,
     macKeyVal: <Buffer 2f 27 b1 e7 85 39 bd f5 e0 b9 2f 91 69 f3 ab c6 1a 4f 14 fc af 66 be 11 33 0b e7 b1 b0 40 c8 89>,
     absValidity: 2018-08-28T03:50:24.772Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 8b 8e 6a 18 8c e8 e7 2b>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 19 0.42105263157894735 1535341884610
connected to auth! from local port 58120
received auth hello!
{ authId: 401, nonce: <Buffer 25 b8 93 5a 52 b9 f9 9c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer e3 16 02 8c 6d 13 72 f9>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100157,
  cipherKeyVal: <Buffer fa 37 e5 d8 f1 06 9e d4 47 27 88 02 8f 6e 8b fa>,
  macKeyVal: <Buffer 38 bd 57 31 cc cc a9 f9 d2 1b f1 ef d2 c4 5e 05 a7 dd d2 f7 18 32 9a 7d 50 38 95 e1 dd 11 bc 9a>,
  absValidity: 2018-08-28T03:51:24.769Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100157,
     cipherKeyVal: <Buffer fa 37 e5 d8 f1 06 9e d4 47 27 88 02 8f 6e 8b fa>,
     macKeyVal: <Buffer 38 bd 57 31 cc cc a9 f9 d2 1b f1 ef d2 c4 5e 05 a7 dd d2 f7 18 32 9a 7d 50 38 95 e1 dd 11 bc 9a>,
     absValidity: 2018-08-28T03:51:24.769Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer e5 6c 7b 70 eb 32 fa 4a>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 20 0.4 1535341944621
connected to auth! from local port 58376
received auth hello!
{ authId: 401, nonce: <Buffer d6 19 60 c4 37 e6 06 37> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 33 3c 99 dd 90 72 8e 3a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100171,
  cipherKeyVal: <Buffer b8 92 0c b4 9a 86 cd e5 59 63 f0 35 94 9a 05 01>,
  macKeyVal: <Buffer 57 59 ad e5 de 01 4c 26 4e 4b 8d 8e ef a8 32 ac 41 25 51 03 74 b8 34 68 c3 03 78 51 0c cc a6 23>,
  absValidity: 2018-08-28T03:52:24.801Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100171,
     cipherKeyVal: <Buffer b8 92 0c b4 9a 86 cd e5 59 63 f0 35 94 9a 05 01>,
     macKeyVal: <Buffer 57 59 ad e5 de 01 4c 26 4e 4b 8d 8e ef a8 32 ac 41 25 51 03 74 b8 34 68 c3 03 78 51 0c cc a6 23>,
     absValidity: 2018-08-28T03:52:24.801Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 5c 61 87 92 d1 fa dc 97>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: handshake1 timed out ...
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 8 21 0.38095238095238093 1535342004631
connected to auth! from local port 58632
received auth hello!
{ authId: 401, nonce: <Buffer 32 0c 38 20 ed 36 db 54> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 46 28 ec c3 ee 8c bd 57>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 40100186,
  cipherKeyVal: <Buffer e3 d2 51 ca 03 4e c3 a9 65 e4 81 ce ba 51 f3 0b>,
  macKeyVal: <Buffer dc 4c c4 a9 9e 35 c0 5f 41 a2 6e d2 c7 0a 69 7d 26 ff 80 64 95 e8 cf 3c f2 fa 04 fd 38 44 f1 32>,
  absValidity: 2018-08-28T03:53:24.770Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.22',
  serverPort: 22100,
  sessionKey: 
   { id: 40100186,
     cipherKeyVal: <Buffer e3 d2 51 ca 03 4e c3 a9 65 e4 81 ce ba 51 f3 0b>,
     macKeyVal: <Buffer dc 4c c4 a9 9e 35 c0 5f 41 a2 6e d2 c7 0a 69 7d 26 ff 80 64 95 e8 cf 3c f2 fa 04 fd 38 44 f1 32>,
     absValidity: 2018-08-28T03:53:24.770Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 1c 34 06 33 05 f5 ce c3>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: Error in secure comm - details: Comm init failed: disconnected from server during communication initialization.10.0.1.22:undefined
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
