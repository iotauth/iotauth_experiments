changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s518.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's518',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 75 39 ... > }
Handler: listening on port 22100
s518:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400041
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46952
received auth hello!
{ authId: 504, nonce: <Buffer c8 28 c4 e4 b1 18 ed 04> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 84 9b f7 2c 02 75 cb 15>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer aa e5 18 41 0d cf 99 07 b8 15 d6 c5 56 0a 67 87>,
  macKeyVal: <Buffer d1 08 72 44 b5 20 91 d3 13 2f 1c 81 d2 7c 9c 7f 5f b5 72 c8 c8 4e 83 88 6b 49 f6 ff c4 af 20 40>,
  absValidity: 2018-08-27T06:59:45.166Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5f 56 ff ab ff 2e ba ea>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 5f 56 ff ab ff 2e ba ea> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.84:47520',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400043
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46980
received auth hello!
{ authId: 504, nonce: <Buffer 9d ea 6d 96 72 90 5b 76> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 54 b9 18 f1 a2 ac 1e 00>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 40 9f ba 43 00 24 d0 80>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 40 9f ba 43 00 24 d0 80> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.85:43668',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400047
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47222
received auth hello!
{ authId: 504, nonce: <Buffer c2 74 5d 1b 24 06 6e 1d> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer fe e1 05 c0 2f c5 09 13>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer cd 1e dd 26 db 21 31 75>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer cd 1e dd 26 db 21 31 75> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.84:47790',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400049
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47250
received auth hello!
{ authId: 504, nonce: <Buffer 16 21 51 b0 26 a6 10 56> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 69 e0 29 27 7e 41 d0 a6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 13 cf 7d 62 5b 62 20 c4>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 13 cf 7d 62 5b 62 20 c4> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.85:43938',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400053
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47492
received auth hello!
{ authId: 504, nonce: <Buffer d1 f5 8f 41 2a b5 59 37> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer df e7 df ea 61 cc b7 bd>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 41 dd 76 37 93 9d e6 82>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 41 dd 76 37 93 9d e6 82> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.84:48060',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400055
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47520
received auth hello!
{ authId: 504, nonce: <Buffer c2 c4 2b b4 81 13 5d e6> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 25 06 d5 53 9f 94 d2 aa>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e3 af e0 9f 32 d6 37 ee>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer e3 af e0 9f 32 d6 37 ee> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.85:44208',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400059
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47762
received auth hello!
{ authId: 504, nonce: <Buffer 08 ae 7d 76 16 58 e3 fa> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c5 63 3b b5 3a 7b 46 87>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 7f e4 50 32 d9 1d 88 f7>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 7f e4 50 32 d9 1d 88 f7> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.84:48330',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400061
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47790
received auth hello!
{ authId: 504, nonce: <Buffer 78 30 a5 84 8c a2 48 94> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer e4 48 63 0a 2a 0c 54 c8>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 6e f9 ca ef cb db b0 05>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 6e f9 ca ef cb db b0 05> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.85:44478',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400065
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48066
received auth hello!
{ authId: 504, nonce: <Buffer 7e 07 91 ce 60 fe c1 de> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a0 7d 3e e1 5a 76 94 b9>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 97 f8 b2 7c eb 7a 18 da>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 97 f8 b2 7c eb 7a 18 da> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.84:48634',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400067
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48094
received auth hello!
{ authId: 504, nonce: <Buffer 52 93 7a 6e cf 16 7d a0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 47 e7 f7 94 27 65 91 06>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 81 94 f1 03 10 fe 20 6a>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 81 94 f1 03 10 fe 20 6a> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.85:44782',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400071
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48336
received auth hello!
{ authId: 504, nonce: <Buffer 93 97 91 53 cc d0 8a 6a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f0 20 68 3a c2 3d f5 1e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 37 82 67 ba bd e7 81 8e>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 37 82 67 ba bd e7 81 8e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 10,
  remoteAddress: '::ffff:10.0.1.84:48904',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 10 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 10 }
specified socketID: 10
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400073
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 48364
received auth hello!
{ authId: 504, nonce: <Buffer 1d d4 8a 52 78 80 bc 88> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ba 89 66 cd 28 45 07 c3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 20 b1 fa ed 4f c7 e5 84>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 20 b1 fa ed 4f c7 e5 84> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 11,
  remoteAddress: '::ffff:10.0.1.85:45052',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 11 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 11 }
specified socketID: 11
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #10 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200376
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200391
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
connected to auth! from local port 33738
received auth hello!
{ authId: 502, nonce: <Buffer 38 00 5f c8 7b 54 00 63> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth504',
     commonName: '10.0.0.7' },
  serial: '016579F45B3E',
  notBefore: 2018-08-27T05:54:41.000Z,
  notAfter: 2018-08-28T05:56:21.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '94:A2:A1:E3:A2:D6:ED:14:E9:D3:29:2B:68:66:23:C2:9E:76:F5:A6',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'A31E9022457B05D056C9FDEDB58BC733BB1B97C16EF02448C451D7DA8BD15C69BDB461E2FD275C96206B77B283645D6BCD71B284A7AC0F1477E8D62ECAA762A3FA674E23957AED10D73D8ED8838AC41A47FAF8FB50BCB1B3A57C246D7D1861A3880C7CCFDEEB58259C62F656BDFDD4ABE6096C88FFA9EEEF3D32230BB86D8FF4C534038264055EB8B3972DC370931A0A38091A1287BFF40D2EF7D92570D86B1837F35A2EA3F7B96EA0870826501C88C4DC0639DA69AE419D997562C46AF20F50D09554213C3EE69AE5685E2446DC62A309CD065472D9BC7AD27221D047D12C6241DBDF5C65881B877D96358D4C273A9F3D8D02DEB84D0581B7EB28209680C6AD',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWV59Fs+MA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDQxETAPBgNVBAMMCDEwLjAuMC43MB4XDTE4MDgy\nNzA1NTQ0MVoXDTE4MDgyODA1NTYyMVowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQCjHpAiRXsF0FbJ/e21i8czuxuXwW7wJEjEUdfai9Fcab20YeL9\nJ1yWIGt3soNkXWvNcbKEp6wPFHfo1i7Kp2Kj+mdOI5V67RDXPY7Yg4rEGkf6+PtQ\nvLGzpXwkbX0YYaOIDHzP3utYJZxi9la9/dSr5glsiP+p7u89MiMLuG2P9MU0A4Jk\nBV64s5ctw3CTGgo4CRoSh7/0DS732SVw2GsYN/NaLqP3uW6ghwgmUByIxNwGOdpp\nrkGdmXVixGryD1DQlVQhPD7mmuVoXiRG3GKjCc0GVHLZvHrSciHQR9EsYkHb31xl\niBuHfZY1jUwnOp89jQLeuE0FgbfrKCCWgMatAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAJ1UuI1iMARRtA6gtKi8IJjuHsdw4vMx\nvAcVrayQ++ImuMgF+cWMut+IYqD808yGgxUNWF6+YXOwnu8j22Ilu8XLu4PmsENl\nbs9rNUG8bRifwDQUEJ8yyA1h+Yvws0UzE0ejCGvpsJ8G1ZbXEz001299UrGuCMa4\nR/EaULmgOF8xycWNptQTWwbfB/AjKl3KBTxdH55sSUMqCixbCkqxj6dIcf/dBAtz\nYOGQUILnfOFr3yVKiORsMPkX2JWrKjsflSqAstKKk1WDVaNUHhFY5h3BrbTT2XkG\npbogGbfYDTyaHIcsTs8OgBFwT3MeB2/Oi4pSlfkCWYeRbZAbss/nkxo=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 0
to: 1
disconnected from auth
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200409
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 33964
received auth hello!
{ authId: 502, nonce: <Buffer 61 0d fb d0 80 19 e3 73> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 18 7d 6f 34 99 69 31 e4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 61 8c 96 06 13 d9 47 cd 0c 32 9b 7e 95 35 18 04>,
  macKeyVal: <Buffer 0f 56 08 8d 5b 63 62 64 81 f1 ea 70 9c 7a 43 8f 47 52 e5 df 95 fc a2 70 fe 11 05 e4 fe bc 68 a1>,
  absValidity: 2018-08-27T07:09:45.344Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 79 32 f1 19 aa 4a 5d d4>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 79 32 f1 19 aa 4a 5d d4> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 12,
  remoteAddress: '::ffff:10.0.1.84:50036',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 12 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 12 }
specified socketID: 12
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #11 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100356
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 33988
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer be ee 79 33 0e 96 2e ff> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer cd 1d 71 f4 95 f4 f9 a2>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a1 25 ae 3a 25 03 1a a3>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer a1 25 ae 3a 25 03 1a a3> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 13,
  remoteAddress: '::ffff:10.0.1.85:46180',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 13 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 13 }
specified socketID: 13
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #13 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100367
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34224
received auth hello!
{ authId: 502, nonce: <Buffer 4f fb 93 79 70 c0 fe e0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 3d d4 93 81 0d 06 0d 26>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d2 81 b9 a0 a1 a2 5b 6f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d2 81 b9 a0 a1 a2 5b 6f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 14,
  remoteAddress: '::ffff:10.0.1.85:46414',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 14 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 14 }
specified socketID: 14
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #12 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200436
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34406
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #14 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100378
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34426
Handler: Error in server - details: handshake2 timed out...
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200449
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34622
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100390
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34642
Handler: Error in server - details: handshake2 timed out...
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer c7 fc c2 05 26 d8 cb 3f> }
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: write after end
received auth hello!
{ authId: 502, nonce: <Buffer 95 c7 91 b3 62 59 48 9e> }
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: write after end
connected to auth! from local port 47220
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
disconnected from auth
disconnected from auth
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100401
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34844
received auth hello!
{ authId: 502, nonce: <Buffer 0a 6b 77 59 46 b8 98 bc> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 47 c9 c2 3f 41 8b 24 d5>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer de 14 71 55 3f 2a 92 e9>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer de 14 71 55 3f 2a 92 e9> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 15,
  remoteAddress: '::ffff:10.0.1.85:47036',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 15 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 15 }
specified socketID: 15
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200466
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 34904
Handler: Error in server - details: handshake2 timed out...
Handler: Error in server - details: Connection with Auth timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Handler: Error in server - details: Connection with Auth timed out...
received auth hello!
{ authId: 502, nonce: <Buffer f3 44 71 18 2b 56 0a 26> }
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: write after end
received auth hello!
{ authId: 502, nonce: <Buffer 88 37 4f 5a 2f 55 73 f7> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer e7 3f e7 7a 37 17 8b c7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 32 1d 71 75 60 c8 33 2c>
Handler: Error in server - details: Error during comm init, details: Error: This socket has been ended by the other party
switching to HANDSHAKE_2_SENT
disconnected from auth
disconnected from auth
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #15 closed
Unidentified client connected
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100414
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35070
Handler: Error in server - details: handshake2 timed out...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200483
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35156
Handler: Error in server - details: Connection with Auth timed out...
received auth hello!
{ authId: 502, nonce: <Buffer a6 f4 53 48 e0 65 79 45> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a6 82 4c 7c 76 c8 bd 6f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 8a 11 84 77 a1 81 40 68>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 8a 11 84 77 a1 81 40 68> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 16,
  remoteAddress: '::ffff:10.0.1.84:51230',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 16 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 16 }
specified socketID: 16
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100425
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35272
received auth hello!
{ authId: 502, nonce: <Buffer 21 28 ca 02 9a 84 b0 4c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a5 ce 2e b1 26 78 53 ad>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a0 6d 0c f3 57 03 80 a5>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer a0 6d 0c f3 57 03 80 a5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 17,
  remoteAddress: '::ffff:10.0.1.85:47464',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 17 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 17 }
specified socketID: 17
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #16 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200490
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35302
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #17 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100438
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
Unidentified client connected
connected to auth! from local port 35500
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200506
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35506
received auth hello!
{ authId: 502, nonce: <Buffer 95 7b fa dd d6 5d a7 f7> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c1 31 63 ce 0c 0a d5 5b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a4 4a 78 4c 9c 80 2e 9f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer a4 4a 78 4c 9c 80 2e 9f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 18,
  remoteAddress: '::ffff:10.0.1.84:51578',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 18 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 18 }
specified socketID: 18
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40100451
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 35716
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
