changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for autoClient: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Clients/c510.config
initializing...
current parameters: { numKeysPerRequest: 3,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: false,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { numKeysPerRequest: 1,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 'c510',
  group: 'Clients',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 73 6f ... > }
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 0 1 0 1521600293777
connected to auth! from local port 55558
received auth hello!
{ authId: 501, nonce: <Buffer 10 fe 32 cb 23 fd 77 d0> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer c6 b3 cb 29 51 2e f4 2d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer e8 12 36 53 fa 30 63 47 c1 9f a4 a2 c4 5b e9 ed>,
  macKeyVal: <Buffer c0 c2 ba 04 7f 31 71 c4 ee 72 b4 2c 62 47 55 a1 c4 0c df 82 b8 eb 4b 34 fe 2e 5a 43 c2 b6 8e 3a>,
  absValidity: 2018-03-21T03:44:53.961Z }
received 1 keys
currentSessionKey: [object Object]
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100594,
  cipherKeyVal: <Buffer 19 0f f3 4e 9a f3 9a 67 86 bf 4d ce 2a 9a 5d 89>,
  macKeyVal: <Buffer 5d 5d 2e 94 c3 d3 44 32 a1 a1 b2 bd 9e be 05 48 11 00 73 7c 13 ff bf 44 0c c9 33 cb 18 f7 d7 bc>,
  absValidity: 2018-03-22T02:44:53.961Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100594,
     cipherKeyVal: <Buffer 19 0f f3 4e 9a f3 9a 67 86 bf 4d ce 2a 9a 5d 89>,
     macKeyVal: <Buffer 5d 5d 2e 94 c3 d3 44 32 a1 a1 b2 bd 9e be 05 48 11 00 73 7c 13 ff bf 44 0c c9 33 cb 18 f7 d7 bc>,
     absValidity: 2018-03-22T02:44:53.961Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
disconnected from auth
chosen nonce: <Buffer 09 2c 51 21 41 25 d4 0e>
switching to HANDSHAKE_1_SENT
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:44:55 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 1 1 1 1521600296204
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 1 2 0.5 1521600353834
connected to auth! from local port 55830
received auth hello!
{ authId: 501, nonce: <Buffer f7 85 59 e0 32 96 e5 3a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer d1 b1 d0 11 ca e0 38 f3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100602,
  cipherKeyVal: <Buffer cb 22 74 ea 0f 31 65 56 93 29 e0 a2 c4 af 10 52>,
  macKeyVal: <Buffer cc 20 c9 4a 05 f8 20 1b c7 84 2e 44 91 1b 91 b0 7c e7 fd db 18 86 70 5f 48 96 42 b8 c4 d4 26 c3>,
  absValidity: 2018-03-22T02:45:54.012Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100602,
     cipherKeyVal: <Buffer cb 22 74 ea 0f 31 65 56 93 29 e0 a2 c4 af 10 52>,
     macKeyVal: <Buffer cc 20 c9 4a 05 f8 20 1b c7 84 2e 44 91 1b 91 b0 7c e7 fd db 18 86 70 5f 48 96 42 b8 c4 d4 26 c3>,
     absValidity: 2018-03-22T02:45:54.012Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 11 0d f2 96 2c 66 83 e8>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:45:55 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 2 2 1 1521600356194
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 2 3 0.6666666666666666 1521600413835
connected to auth! from local port 56100
received auth hello!
{ authId: 501, nonce: <Buffer 73 9f 0f f6 82 b4 21 90> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer d1 db de 68 b6 d4 03 67>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100610,
  cipherKeyVal: <Buffer ae 6f 01 2f b5 58 a4 48 17 24 27 0e d8 d0 6c e1>,
  macKeyVal: <Buffer f1 16 52 02 6d ba f0 12 08 14 5b c3 46 db d3 1b 26 ad 1c e6 e6 0f f3 79 17 a4 b0 57 79 5e 08 e4>,
  absValidity: 2018-03-22T02:46:54.022Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100610,
     cipherKeyVal: <Buffer ae 6f 01 2f b5 58 a4 48 17 24 27 0e d8 d0 6c e1>,
     macKeyVal: <Buffer f1 16 52 02 6d ba f0 12 08 14 5b c3 46 db d3 1b 26 ad 1c e6 e6 0f f3 79 17 a4 b0 57 79 5e 08 e4>,
     absValidity: 2018-03-22T02:46:54.022Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 10 7b a1 21 68 b2 f6 a2>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:46:56 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 3 3 1 1521600416342
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 3 4 0.75 1521600473894
connected to auth! from local port 56370
received auth hello!
{ authId: 501, nonce: <Buffer 99 6e 22 02 e9 23 97 ae> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ca 74 19 5e d6 55 1a b3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100618,
  cipherKeyVal: <Buffer 06 c3 5d b6 5f df d7 57 df 9e 34 c0 b9 7b 29 ec>,
  macKeyVal: <Buffer 97 83 0e 51 f2 c2 6b e9 25 79 cf da 8e 5c eb 6d 82 19 81 94 97 b4 cc 9f bd 11 ed 8a f5 5b 55 4e>,
  absValidity: 2018-03-22T02:47:54.100Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100618,
     cipherKeyVal: <Buffer 06 c3 5d b6 5f df d7 57 df 9e 34 c0 b9 7b 29 ec>,
     macKeyVal: <Buffer 97 83 0e 51 f2 c2 6b e9 25 79 cf da 8e 5c eb 6d 82 19 81 94 97 b4 cc 9f bd 11 ed 8a f5 5b 55 4e>,
     absValidity: 2018-03-22T02:47:54.100Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 42 f5 49 23 ac 59 cc 8e>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:47:56 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 4 4 1 1521600476292
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 4 5 0.8 1521600533949
connected to auth! from local port 56640
received auth hello!
{ authId: 501, nonce: <Buffer 89 62 6a cc 40 5b 28 aa> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a5 f0 cd 44 ac 1f b0 49>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100626,
  cipherKeyVal: <Buffer c1 f6 53 d1 d6 ec f8 f2 30 9c cf 58 3b db 89 ad>,
  macKeyVal: <Buffer 80 fd 91 5d d2 3a 96 17 3b 76 d9 d9 a4 96 9b a3 bd f7 20 d3 ce 2c 6a 20 2b 53 74 bb 88 05 c9 cc>,
  absValidity: 2018-03-22T02:48:54.124Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100626,
     cipherKeyVal: <Buffer c1 f6 53 d1 d6 ec f8 f2 30 9c cf 58 3b db 89 ad>,
     macKeyVal: <Buffer 80 fd 91 5d d2 3a 96 17 3b 76 d9 d9 a4 96 9b a3 bd f7 20 d3 ce 2c 6a 20 2b 53 74 bb 88 05 c9 cc>,
     absValidity: 2018-03-22T02:48:54.124Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer e6 e6 f5 fe c5 ee 52 1a>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:48:56 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 5 5 1 1521600536369
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 5 6 0.8333333333333334 1521600594005
connected to auth! from local port 56910
received auth hello!
{ authId: 501, nonce: <Buffer 29 13 1e 0b c3 21 75 e1> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 2c 81 ee 49 7a 86 ad 12>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100634,
  cipherKeyVal: <Buffer cd 72 18 e2 10 86 7f 3f 14 d0 7a f9 31 6d fb e9>,
  macKeyVal: <Buffer 9b 20 da e9 76 6f c4 f2 8e 67 60 7f 01 6c c4 ec 0e 59 5a 88 80 41 e2 cf d6 54 b4 b6 41 74 48 b9>,
  absValidity: 2018-03-22T02:49:54.166Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100634,
     cipherKeyVal: <Buffer cd 72 18 e2 10 86 7f 3f 14 d0 7a f9 31 6d fb e9>,
     macKeyVal: <Buffer 9b 20 da e9 76 6f c4 f2 8e 67 60 7f 01 6c c4 ec 0e 59 5a 88 80 41 e2 cf d6 54 b4 b6 41 74 48 b9>,
     absValidity: 2018-03-22T02:49:54.166Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 1f bb bb 8a 6c e2 80 60>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:49:56 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 6 6 1 1521600596446
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 6 7 0.8571428571428571 1521600654060
connected to auth! from local port 57176
received auth hello!
{ authId: 501, nonce: <Buffer 09 cb b3 04 fe 92 ea cd> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 77 62 6e e8 dd 1f 8e c4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
currentSessionKey: [object Object]
Status: Secure connection closed before starting a new connection.
Session protocol: TCP
chosen commSessionKey: 
{ id: 50100642,
  cipherKeyVal: <Buffer 76 09 67 7c 36 92 da 22 a2 12 72 04 ec 2e 42 ba>,
  macKeyVal: <Buffer a8 76 20 d1 16 33 6e d1 3e 82 e4 78 cc c3 17 cc 9e 11 11 fe dc 26 99 05 da 2e c0 42 a7 c4 38 0a>,
  absValidity: 2018-03-22T02:50:54.203Z,
  relValidity: 7200000 }
options
{ serverHost: '10.0.1.30',
  serverPort: 22100,
  sessionKey: 
   { id: 50100642,
     cipherKeyVal: <Buffer 76 09 67 7c 36 92 da 22 a2 12 72 04 ec 2e 42 ba>,
     macKeyVal: <Buffer a8 76 20 d1 16 33 6e d1 3e 82 e4 78 cc c3 17 cc 9e 11 11 fe dc 26 99 05 da 2e c0 42 a7 c4 38 0a>,
     absValidity: 2018-03-22T02:50:54.203Z,
     relValidity: 7200000 },
  sessionCryptoSpec: { cipher: 'AES-128-CBC', mac: 'SHA256' },
  sessionProtocol: 'TCP',
  handshakeTimeout: 50000 }
chosen nonce: <Buffer 36 02 4b 15 cb fb 35 1c>
switching to HANDSHAKE_1_SENT
disconnected from auth
Handler: secure connection with the server closed.
received session key handshake2!
client ret: [object Object]
server authenticated/authorized by solving nonce!
Handler: communication initialization succeeded
file data length: 1024
sending at Wed Mar 21 2018 02:50:56 GMT+0000 (UTC)
switching to IN_COMM
received secure communication message!
Received seqNum: 0
Handler: data received from server via secure communication
data1
Resp-actual/expected/ratio/ts: 7 7 1 1521600656536
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 7 8 0.875 1521600714118
failure in connection with Auth : authFailureCount: 1
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in secure comm - details: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 7 9 0.7777777777777778 1521600774129
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in secure comm - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.3:21100
Handler: Error in secure comm - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in secure comm - details: Error occurred in migration request: Auth hello timedout ...
Distribution protocol: TCP
Resp-actual/expected/ratio/ts: 7 10 0.7 1521600834136
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in secure comm - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 47346
Handler: Error in secure comm - details: Auth hello timedout ...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
