changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s518.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's518',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 77 49 42 41 41 4b 43 41 51 45 41 6d 48 ... > }
Handler: listening on port 22100
s518:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400152
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46456
received auth hello!
{ authId: 504, nonce: <Buffer 28 0c b9 07 61 91 78 f6> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer ee 8b 58 4c 16 95 58 cb>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer b2 e6 b6 87 5e a6 02 86 78 34 f6 70 3d ca 79 62>,
  macKeyVal: <Buffer 75 60 9b dd 44 a6 3e 95 e1 f9 36 f3 c6 d5 e7 8f 56 4d d4 fb 8d 01 22 2d 7b 8f 0d bf 90 7b fc 1e>,
  absValidity: 2018-03-20T22:31:19.494Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 1b cb 22 91 58 f6 39 53>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 1b cb 22 91 58 f6 39 53> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.84:55798',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400154
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46488
received auth hello!
{ authId: 504, nonce: <Buffer 44 a7 67 9f ee 7f 71 48> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 17 0c 81 7d e2 fa 76 64>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 75 21 84 e3 b4 ec 24 de>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 75 21 84 e3 b4 ec 24 de> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.85:43054',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400158
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46726
received auth hello!
{ authId: 504, nonce: <Buffer a6 b6 d1 3d da f5 8a e4> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 91 fb 9c 26 24 31 fb e8>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 52 4c 5b e5 76 2a a7 0b>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 52 4c 5b e5 76 2a a7 0b> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.84:56068',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400160
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46758
received auth hello!
{ authId: 504, nonce: <Buffer 5f 58 86 db f5 75 15 0a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 9b a0 81 2d cd 95 c6 fc>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 90 21 b8 68 4e 3b e4 66>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 90 21 b8 68 4e 3b e4 66> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.85:43322',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400164
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 46996
received auth hello!
{ authId: 504, nonce: <Buffer a8 e9 59 45 b6 3b 8f 24> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer be 20 5f 4e 8e d7 29 2d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f2 25 b0 3a a6 b4 c7 1f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f2 25 b0 3a a6 b4 c7 1f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.84:56338',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400166
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47028
received auth hello!
{ authId: 504, nonce: <Buffer 51 3a 54 7e f9 08 15 eb> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 51 a1 ca b3 0b 2b af bd>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 3c 36 81 27 a3 c4 de 4c>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 3c 36 81 27 a3 c4 de 4c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.85:43592',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400170
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47266
received auth hello!
{ authId: 504, nonce: <Buffer 41 ec 26 dc 7f 00 55 1d> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 43 d6 65 dc 94 7b 3f f1>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 01 01 15 4c ec d1 2c b8>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 01 01 15 4c ec d1 2c b8> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.84:56608',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400172
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47298
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 504, nonce: <Buffer 0b 88 b4 77 54 f3 71 f5> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 12 bf f0 4c 6b 41 3a d2>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 56 37 da 96 f7 b0 c1 58>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 56 37 da 96 f7 b0 c1 58> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.85:43862',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400176
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47536
received auth hello!
{ authId: 504, nonce: <Buffer dc 43 7c e1 03 fe dd f0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 05 d0 df 77 45 e4 5f 91>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 97 78 2a 77 c4 23 d4 08>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 97 78 2a 77 c4 23 d4 08> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.84:56878',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400178
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47568
received auth hello!
{ authId: 504, nonce: <Buffer 08 f6 1e d1 1a 8b 58 5f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer aa 51 02 04 ee 65 dc ab>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 92 f7 26 f8 10 7a cd 15>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 92 f7 26 f8 10 7a cd 15> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.85:44132',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400182
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47806
received auth hello!
{ authId: 504, nonce: <Buffer 6c aa f9 95 c9 b6 6c a0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 39 18 3e fd 7f 1e ed 6c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 48 74 f5 58 55 85 5d eb>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 48 74 f5 58 55 85 5d eb> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 10,
  remoteAddress: '::ffff:10.0.1.84:57148',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 10 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 10 }
specified socketID: 10
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50400184
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 47838
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 504, nonce: <Buffer a3 e3 e6 b0 7d a0 9d e3> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer af 85 5b 15 ca 7d 2f 7f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e4 33 30 22 5c 6e 15 b6>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e4 33 30 22 5c 6e 15 b6> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 11,
  remoteAddress: '::ffff:10.0.1.85:44402',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 11 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 11 }
specified socketID: 11
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #10 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101111
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101120
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.6:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101140
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.3:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101151
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
connected to auth! from local port 55172
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101160
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 5
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.7:21100
connected to auth! from local port 55374
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #11 closed
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
