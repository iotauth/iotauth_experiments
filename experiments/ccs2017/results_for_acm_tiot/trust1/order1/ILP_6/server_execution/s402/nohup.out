changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s402.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's402',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 67 49 42 41 41 4b 43 41 51 45 41 34 57 ... > }
Handler: listening on port 22100
s402:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101408
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50356
received auth hello!
{ authId: 401, nonce: <Buffer 34 49 21 6b c1 f1 39 53> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 90 c4 55 54 6b 2c d3 f1>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 8a 6c ed a0 8a 1a 51 fe 6d ed d9 e8 e9 99 70 5f>,
  macKeyVal: <Buffer a6 2c 20 38 f4 5a 1f 6b d9 bd 48 10 4d 26 cc de 1b 7f cb 4b f0 93 9e 96 02 17 b8 fc b4 a9 09 31>,
  absValidity: 2018-03-21T04:21:32.818Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a5 05 dc 4e e8 35 a4 4b>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer a5 05 dc 4e e8 35 a4 4b> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.44:51334',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101414
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50476
received auth hello!
{ authId: 401, nonce: <Buffer 8b f5 3a 54 4b cc 16 4b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 77 fe af c4 eb ea ff 7e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 7a 4e dd d9 bc dc b6 be>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 7a 4e dd d9 bc dc b6 be> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.44:51454',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101420
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50706
received auth hello!
{ authId: 401, nonce: <Buffer 8d 57 c7 0d 99 40 4e 80> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 1c 69 25 ef 4d 72 cb 9c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 3f 08 7f e9 1d 7e ad 84>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 3f 08 7f e9 1d 7e ad 84> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.44:51684',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101426
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50976
received auth hello!
{ authId: 401, nonce: <Buffer 15 30 bb 88 68 73 47 42> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 2a db 81 64 c9 e1 28 25>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c5 d6 4b 7f 25 49 4f 28>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer c5 d6 4b 7f 25 49 4f 28> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.44:51954',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101432
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51246
received auth hello!
{ authId: 401, nonce: <Buffer 87 e7 7b 5a 2f 40 a8 e5> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 74 c6 76 6f 8d 7f 9d ea>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer eb 12 e9 73 eb 7a 6d 3c>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer eb 12 e9 73 eb 7a 6d 3c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.44:52224',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101438
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51516
received auth hello!
{ authId: 401, nonce: <Buffer 71 f3 a1 8e da 34 74 44> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer b9 9c f5 34 94 c9 cc 6f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 97 b3 42 4d c1 1a e4 2f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 97 b3 42 4d c1 1a e4 2f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.44:52494',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101444
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51786
received auth hello!
{ authId: 401, nonce: <Buffer 5d 69 e3 7b a8 15 ff f2> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 55 c6 94 3f b2 38 77 5b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ce 84 d8 d7 b7 2c 54 54>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ce 84 d8 d7 b7 2c 54 54> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.44:52764',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101450
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52056
received auth hello!
{ authId: 401, nonce: <Buffer 77 d5 f0 f0 6c 5c ef 74> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 8b b6 14 46 14 61 2b f3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f5 d7 b1 f8 0f 48 85 05>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer f5 d7 b1 f8 0f 48 85 05> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.44:53034',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40101456
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52318
received auth hello!
{ authId: 401, nonce: <Buffer 87 99 10 6e d8 1c 72 2b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 9d 57 8f 4e f3 af 3e 49>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer fa ae 13 b2 75 ad 8b fe>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer fa ae 13 b2 75 ad 8b fe> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.44:53296',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201427
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.1:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201626
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.1:21100
connected to auth! from local port 53924
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 25 ca 63 5d 5c c4 b5 31> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth401',
     commonName: '10.0.0.1' },
  serial: '0162469261A3',
  notBefore: 2018-03-21T03:18:41.000Z,
  notAfter: 2018-03-22T03:20:21.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '4C:EC:5C:20:C7:CD:EF:0F:EB:B9:84:94:B4:A5:18:CE:39:84:EB:51',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'FF6CB5202497CC77AF28EFDE774858E4FEF04355E5228E378962DF4235BE3683DAF9E38A7E22621D66B3B50166D897E97BF911F9E8FC09D686961AA39679014E5DDD27EA0F02DE853A41537DB5E37F33395E249F355C0D074419572E9856D1D598CAB2CD6951013DDCB0A163B943DFCD2694BE18B9B3892695B3052EBD9115D447293C83AF24A008794B842E4F0A6C2A8D0189612A600AA40A592603E43713C0ECCA681024E5EC429FAD09484B824919DF59C8BD488E0D372D2A3D8B99B6068E24BBBDA8F0BCDDBA806010E4A7181736DF08D4D1CFC16E26507C360EDCBFF1B5F4288CE304DE62E9696665C5108489AD7232658356998FF47C4F7E8A04225423',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWJGkmGjMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg0MDExETAPBgNVBAMMCDEwLjAuMC4xMB4XDTE4MDMy\nMTAzMTg0MVoXDTE4MDMyMjAzMjAyMVowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQD/bLUgJJfMd68o7953SFjk/vBDVeUijjeJYt9CNb42g9r544p+\nImIdZrO1AWbYl+l7+RH56PwJ1oaWGqOWeQFOXd0n6g8C3oU6QVN9teN/MzleJJ81\nXA0HRBlXLphW0dWYyrLNaVEBPdywoWO5Q9/NJpS+GLmziSaVswUuvZEV1EcpPIOv\nJKAIeUuELk8KbCqNAYlhKmAKpApZJgPkNxPA7MpoECTl7EKfrQlIS4JJGd9ZyL1I\njg03LSo9i5m2Bo4ku72o8LzduoBgEOSnGBc23wjU0c/BbiZQfDYO3L/xtfQojOME\n3mLpaWZlxRCEia1yMmWDVpmP9HxPfooEIlQjAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAFnTVXEOlJGyhqLSdf0h2VrhzhIl4BSI\nYRm7gHmUB4kNQkRPveYyqn0shzv1cNkLsWnuULxIRMyAvKuj1IarOIurGtcsGwv9\nwLZiR4jTzTxbX3aRXWw8rX2jnbgkF+AaLZna31Grij4TktPtdjoW18/G6Tk3TQTh\nLf7qmQCf/MrfMFeOZWeeO2Rnzb1KP/oy/8WSfFczH0HW1qsvniRax0d8G05Vi0U1\nq++i3ZkmUY3EeLWVd2FK7NoBdHLkr3iPTuckLDP/E88fnHwGnPhR5iHLpoWrw1Dp\njyaJdLdnwD0HMQlPMMKCR/3IX6/DK9hOcJGEfTAW5OhTDB5INQJ/Y1k=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 0
to: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201641
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54068
received auth hello!
{ authId: 502, nonce: <Buffer d8 c7 ea ba ba 93 f1 52> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 2d ff 47 86 c4 ae 79 74>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 40 1f 01 63 7e 7f ea 0e 69 4f 54 c9 73 c7 f4 1f>,
  macKeyVal: <Buffer b2 fc 1c 80 30 29 04 2d 4e b5 c0 94 e7 2b 9f 06 22 24 d1 35 0d ea b9 3d f3 fd 3c 66 ce 62 b7 5e>,
  absValidity: 2018-03-21T04:49:16.548Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 1f 22 c3 a9 75 86 af c2>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 1f 22 c3 a9 75 86 af c2> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.44:56400',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
