changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s515.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's515',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 77 49 42 41 41 4b 43 41 51 45 41 79 63 ... > }
Handler: listening on port 22100
s515:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300737
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 41366
received auth hello!
{ authId: 503, nonce: <Buffer b4 37 75 df 82 18 08 90> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 8e 07 a2 ed e0 b2 c7 63>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 98 0a c3 cb b9 c1 07 ac eb e5 ad 01 38 7c 79 09>,
  macKeyVal: <Buffer b7 94 80 78 40 b9 82 80 95 de 27 a0 05 07 9f a8 36 21 42 5c 69 eb 98 84 21 2e 77 66 3c b7 32 6a>,
  absValidity: 2018-03-21T04:23:34.209Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 03 2a 53 b7 e5 c7 d7 f5>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 03 2a 53 b7 e5 c7 d7 f5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.81:50570',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300742
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 41636
received auth hello!
{ authId: 503, nonce: <Buffer f6 0b 94 17 57 7f 46 64> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 97 2c 51 78 b0 57 3f 96>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 65 39 79 14 fd 43 e7 76>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 65 39 79 14 fd 43 e7 76> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.81:50840',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300747
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 41906
received auth hello!
{ authId: 503, nonce: <Buffer ff d1 3f cf 86 4a e0 53> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer dc 30 ba 00 25 ab 2c 46>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 38 c3 f1 a9 5c ae 23 be>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 38 c3 f1 a9 5c ae 23 be> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.81:51110',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300752
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 42176
received auth hello!
{ authId: 503, nonce: <Buffer 04 60 b9 d6 8b 9d 81 80> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ad 38 26 bd 42 9e 2d 82>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 35 fb b2 ed 95 f9 fe 03>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 35 fb b2 ed 95 f9 fe 03> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.81:51380',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300757
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 42446
received auth hello!
{ authId: 503, nonce: <Buffer da c5 84 33 e7 b7 4b 98> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 05 df e4 05 f3 ec f4 74>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 93 69 5c 26 04 bf e0 59>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 93 69 5c 26 04 bf e0 59> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.81:51650',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300762
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 42716
received auth hello!
{ authId: 503, nonce: <Buffer 34 06 d0 23 14 82 a8 ed> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 15 f6 2c c9 e9 f7 e1 88>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e8 66 db 9c a7 bb d6 20>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer e8 66 db 9c a7 bb d6 20> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.81:51920',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300767
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 42978
received auth hello!
{ authId: 503, nonce: <Buffer a3 3d 14 6d e1 cd 25 22> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 6e 27 d1 b7 83 ad de 93>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 43 ac d2 08 c8 50 f9 4f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 43 ac d2 08 c8 50 f9 4f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.81:52182',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201586
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.6:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201617
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.6:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.1:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201633
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.6:21100
connected to auth! from local port 39016
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201670
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.6:21100
connected to auth! from local port 39354
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 94 dc 11 6b 69 cc ef ca> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth503',
     commonName: '10.0.0.6' },
  serial: '0162469268AF',
  notBefore: 2018-03-21T03:18:42.000Z,
  notAfter: 2018-03-22T03:20:22.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: '1D:27:C3:AB:64:0A:C5:CD:65:6B:32:D2:6F:93:CB:C2:3A:F2:93:CA',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'FF6CB5202497CC77AF28EFDE774858E4FEF04355E5228E378962DF4235BE3683DAF9E38A7E22621D66B3B50166D897E97BF911F9E8FC09D686961AA39679014E5DDD27EA0F02DE853A41537DB5E37F33395E249F355C0D074419572E9856D1D598CAB2CD6951013DDCB0A163B943DFCD2694BE18B9B3892695B3052EBD9115D447293C83AF24A008794B842E4F0A6C2A8D0189612A600AA40A592603E43713C0ECCA681024E5EC429FAD09484B824919DF59C8BD488E0D372D2A3D8B99B6068E24BBBDA8F0BCDDBA806010E4A7181736DF08D4D1CFC16E26507C360EDCBFF1B5F4288CE304DE62E9696665C5108489AD7232658356998FF47C4F7E8A04225423',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWJGkmivMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDMxETAPBgNVBAMMCDEwLjAuMC42MB4XDTE4MDMy\nMTAzMTg0MloXDTE4MDMyMjAzMjAyMlowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQD/bLUgJJfMd68o7953SFjk/vBDVeUijjeJYt9CNb42g9r544p+\nImIdZrO1AWbYl+l7+RH56PwJ1oaWGqOWeQFOXd0n6g8C3oU6QVN9teN/MzleJJ81\nXA0HRBlXLphW0dWYyrLNaVEBPdywoWO5Q9/NJpS+GLmziSaVswUuvZEV1EcpPIOv\nJKAIeUuELk8KbCqNAYlhKmAKpApZJgPkNxPA7MpoECTl7EKfrQlIS4JJGd9ZyL1I\njg03LSo9i5m2Bo4ku72o8LzduoBgEOSnGBc23wjU0c/BbiZQfDYO3L/xtfQojOME\n3mLpaWZlxRCEia1yMmWDVpmP9HxPfooEIlQjAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBAB9w+Zza1811ywob7sNL2ckUhOnGDdVD\nta9ZoMiKoFtFgIdUUlnoZYPadNkJTl2ayABCgcmxyoxzu+RCgqRt06bnMo5nKm4a\nW6B3HLeuhn+GJGW0vm0icZlJ4U0m3c77+2CSqlax059NU51OrhHCTfj7IWzFiJQc\np0CBkqEAnggC7t0w6sDezoz4GxcuHNDT/mk8Lf8IiswoiBBu2FL2hQVGJdpTJhfX\ngFHEZt8jLuY3XjtNxcaLNAAmcM+3nGf4uFLqqMEznVltZDzER16/rksEjHmN2nCK\neucQDIdmpACkbVZVychpOS4kFx6qyMTtrGkWbiSKDpqivzR0IthSilI=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 1
to: 2
disconnected from auth
received auth hello!
{ authId: 502, nonce: <Buffer 37 e0 cd ef ee f8 29 04> }
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: write after end
disconnected from auth
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Connection with Auth timed out...
