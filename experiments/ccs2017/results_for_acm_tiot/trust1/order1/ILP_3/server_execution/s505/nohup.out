changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s505.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's505',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 51 49 42 41 41 4b 43 41 51 45 41 7a 43 ... > }
Handler: listening on port 22100
s505:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100479
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50792
received auth hello!
{ authId: 501, nonce: <Buffer 76 c7 2d 20 ed fb fa f1> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 83 58 b1 47 c0 81 df 96>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer d4 3f 25 1b 89 99 08 8c 4a 3b 36 97 96 9a 9c d5>,
  macKeyVal: <Buffer 4a 60 25 6b 36 44 b0 8d 99 59 b6 91 5e c5 d4 60 94 c1 41 ad fb f3 5b 47 40 62 6c 1b 77 cf 1f ad>,
  absValidity: 2018-03-21T02:22:09.316Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 91 c8 74 8a 79 34 d9 04>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 91 c8 74 8a 79 34 d9 04> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.68:50078',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100480
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 50804
received auth hello!
{ authId: 501, nonce: <Buffer 71 0f c8 81 e8 03 10 f6> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 77 a4 0f 27 5a ad 7d 6b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 0b 5c 87 73 50 8b 77 4c>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 0b 5c 87 73 50 8b 77 4c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.69:38750',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100487
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51054
received auth hello!
{ authId: 501, nonce: <Buffer f7 56 ac fc 47 e7 51 c6> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 37 bc 37 cf 9a 87 d0 61>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c7 f9 e8 12 7d 39 1e ea>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c7 f9 e8 12 7d 39 1e ea> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.68:50340',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100488
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51072
received auth hello!
{ authId: 501, nonce: <Buffer aa 1b 05 09 89 53 97 4e> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ad db 7a 01 4d 4e 63 51>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 13 aa c6 df 9c 5b f4 30>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 13 aa c6 df 9c 5b f4 30> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.69:39018',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100495
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51324
received auth hello!
{ authId: 501, nonce: <Buffer 86 1f e3 00 7b 00 68 ea> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 3d 79 d4 8c 8e 14 26 81>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c6 3c ef ea 95 cc 2b a8>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c6 3c ef ea 95 cc 2b a8> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.68:50610',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100496
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51342
received auth hello!
{ authId: 501, nonce: <Buffer ff ad ad 44 67 2a 2e 76> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer aa d9 8b 9a 1b 1b 3c f7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f7 4b 17 f6 c3 18 63 91>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f7 4b 17 f6 c3 18 63 91> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.69:39288',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100503
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51594
received auth hello!
{ authId: 501, nonce: <Buffer dc ef 2e b6 04 0c 03 53> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer fb 1a 23 20 6e 81 bc 47>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 1d f6 0b 8b 52 13 2d 9f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 1d f6 0b 8b 52 13 2d 9f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.68:50880',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100504
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51612
received auth hello!
{ authId: 501, nonce: <Buffer c9 17 11 82 38 f2 fa 3b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer dc 47 d1 41 42 f7 2c c8>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f3 4b 95 e8 22 4c 87 7a>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f3 4b 95 e8 22 4c 87 7a> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.69:39558',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100511
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51864
received auth hello!
{ authId: 501, nonce: <Buffer f8 01 a4 44 16 ef 48 16> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f3 fe af 30 96 a9 dc 73>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 78 19 48 2f 48 09 64 66>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 78 19 48 2f 48 09 64 66> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.68:51150',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100512
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 51882
received auth hello!
{ authId: 501, nonce: <Buffer 64 09 e4 cc 52 be a3 ef> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 2a c3 fe d5 4f 2e 1b c4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f0 e8 b7 94 cd 27 35 80>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f0 e8 b7 94 cd 27 35 80> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.69:39828',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100519
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52134
received auth hello!
{ authId: 501, nonce: <Buffer 13 90 35 71 b4 15 09 05> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer db 39 7e aa 35 6e ce fa>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 12 e8 35 53 0e 85 63 2b>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 12 e8 35 53 0e 85 63 2b> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 10,
  remoteAddress: '::ffff:10.0.1.68:51420',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 10 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 10 }
specified socketID: 10
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100520
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52152
received auth hello!
{ authId: 501, nonce: <Buffer 76 fc e2 a8 91 b3 be 92> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 66 ec 9b 87 fd 11 ac 6f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f0 51 df d2 8e 31 af be>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer f0 51 df d2 8e 31 af be> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 11,
  remoteAddress: '::ffff:10.0.1.69:40098',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 11 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 11 }
specified socketID: 11
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #10 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100527
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52404
received auth hello!
{ authId: 501, nonce: <Buffer fe c8 2d df 0d f8 b7 aa> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a1 7a fe d1 06 43 64 1e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f8 4d 36 88 70 48 df 60>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer f8 4d 36 88 70 48 df 60> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 12,
  remoteAddress: '::ffff:10.0.1.68:51690',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 12 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 12 }
specified socketID: 12
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #11 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100528
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 52422
received auth hello!
{ authId: 501, nonce: <Buffer a5 7d a9 d4 b8 09 b8 3d> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 1b 8a dd 3d fa 32 00 2f>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 26 8c ed 08 36 03 31 c0>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 26 8c ed 08 36 03 31 c0> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 13,
  remoteAddress: '::ffff:10.0.1.69:40368',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 13 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 13 }
specified socketID: 13
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #12 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200447
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200456
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 47488
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
