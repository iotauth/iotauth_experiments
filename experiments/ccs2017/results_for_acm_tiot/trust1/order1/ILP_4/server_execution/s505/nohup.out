changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s505.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's505',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 51 49 42 41 41 4b 43 41 51 45 41 7a 43 ... > }
Handler: listening on port 22100
s505:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100535
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57720
received auth hello!
{ authId: 501, nonce: <Buffer 9c 7a 69 38 a0 c6 06 1e> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer bb 7f 7e 03 c2 d1 75 72>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 3b 57 ea 4d 1f 3f d7 6c 32 23 48 14 61 58 7e e9>,
  macKeyVal: <Buffer 2d f0 2e bf 2d cc e5 be c9 6e a1 26 36 c3 33 93 06 a8 3b 8e 62 d3 5e 26 a3 e6 0f 08 a9 4c 15 4b>,
  absValidity: 2018-03-21T02:59:23.406Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d5 52 fc de ce 32 72 c3>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer d5 52 fc de ce 32 72 c3> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.68:57006',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100536
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57732
received auth hello!
{ authId: 501, nonce: <Buffer 8d 0d 06 25 4c 30 9c f9> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f5 27 62 10 51 27 22 6e>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ec 02 47 fc 6f a8 9b a4>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ec 02 47 fc 6f a8 9b a4> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.69:45678',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100543
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57982
received auth hello!
{ authId: 501, nonce: <Buffer cb cf 89 cd ec de 5e 96> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 06 c8 e2 bc 76 e3 13 6d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ae 5c 55 c7 c0 19 eb bf>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ae 5c 55 c7 c0 19 eb bf> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.68:57268',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100544
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58000
received auth hello!
{ authId: 501, nonce: <Buffer 3f 93 75 96 48 e3 42 34> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 40 8c 13 2e 35 b6 15 6c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f7 f9 60 f2 29 ee f3 57>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f7 f9 60 f2 29 ee f3 57> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.69:45946',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100551
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58252
received auth hello!
{ authId: 501, nonce: <Buffer e1 80 61 da 5b 23 1b d7> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5a 63 ba 70 84 e9 1c de>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer cd 65 3b 36 7c 0d 46 43>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer cd 65 3b 36 7c 0d 46 43> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.68:57538',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100552
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58270
received auth hello!
{ authId: 501, nonce: <Buffer 9c 63 0e f6 9d 4b a6 e0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 30 b1 4a c5 94 fc f5 3c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 22 bd a1 ba 48 a3 55 1e>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 22 bd a1 ba 48 a3 55 1e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.69:46216',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100559
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58522
received auth hello!
{ authId: 501, nonce: <Buffer 28 82 c8 72 40 64 c6 95> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer db d4 25 2e 2e fb be f5>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c0 5a 2d 86 43 fd ee 81>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c0 5a 2d 86 43 fd ee 81> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.68:57808',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100560
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58540
received auth hello!
{ authId: 501, nonce: <Buffer aa 26 45 49 98 fa a5 a3> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c0 ed ea 4b 99 44 e9 d5>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5f 9a b1 95 c2 95 dd 06>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 5f 9a b1 95 c2 95 dd 06> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.69:46486',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100567
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58792
received auth hello!
{ authId: 501, nonce: <Buffer ea 95 5b 01 06 26 60 c0> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 10 92 95 df 71 82 26 58>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 3f eb b3 32 f7 0f 5e 02>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 3f eb b3 32 f7 0f 5e 02> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.68:58078',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100568
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58810
received auth hello!
{ authId: 501, nonce: <Buffer 30 d2 1f 46 af 9f 0e 2e> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5c 02 56 b6 92 8b 55 65>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 3c 8b f9 db 3c 95 68 d4>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 3c 8b f9 db 3c 95 68 d4> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 9,
  remoteAddress: '::ffff:10.0.1.69:46756',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 9 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 9 }
specified socketID: 9
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100575
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 59062
received auth hello!
{ authId: 501, nonce: <Buffer 57 d8 96 6a 11 a5 80 0b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 07 bd a2 10 2c f2 56 73>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 73 45 1f 7b de 70 22 a9>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 73 45 1f 7b de 70 22 a9> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 10,
  remoteAddress: '::ffff:10.0.1.68:58348',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 10 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 10 }
specified socketID: 10
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #9 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100576
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 59080
received auth hello!
{ authId: 501, nonce: <Buffer 7a 42 59 74 8c ea 3f cb> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 33 66 08 ea 71 5d 9f 08>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer b9 c1 8e 62 23 61 4a f7>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer b9 c1 8e 62 23 61 4a f7> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 11,
  remoteAddress: '::ffff:10.0.1.69:47026',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 11 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 11 }
specified socketID: 11
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #10 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100583
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 59332
received auth hello!
{ authId: 501, nonce: <Buffer 5e 6d f9 85 32 ef 57 c7> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5f af 8f 2b 06 99 e8 9d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 12 22 fc 95 72 ce 1a 3f>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 12 22 fc 95 72 ce 1a 3f> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 12,
  remoteAddress: '::ffff:10.0.1.68:58618',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 12 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 12 }
specified socketID: 12
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #11 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100584
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 59350
received auth hello!
{ authId: 501, nonce: <Buffer 87 53 da 54 45 f8 a9 26> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer bc 66 c0 8f bd f5 4f 13>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a1 d1 39 be fb c0 3e d6>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer a1 d1 39 be fb c0 3e d6> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 13,
  remoteAddress: '::ffff:10.0.1.69:47296',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 13 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 13 }
specified socketID: 13
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #12 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200773
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200782
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 54392
Handler: Error in server - details: handshake2 timed out...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
