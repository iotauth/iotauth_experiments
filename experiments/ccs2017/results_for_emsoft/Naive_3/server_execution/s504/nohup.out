changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s504.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's504',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 77 49 42 41 41 4b 43 41 51 45 41 71 78 ... > }
Handler: listening on port 22100
s504:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100445
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56398
received auth hello!
{ authId: 501, nonce: <Buffer 26 99 6d 74 ee bf d2 75> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 27 ab 13 f8 08 de 6a 70>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer be 30 c9 6b d8 51 03 0f 1e b8 a9 d8 30 89 9d 2e>,
  macKeyVal: <Buffer d9 9f a3 86 dc d3 41 17 a6 24 9c e8 b6 34 a5 56 f0 d3 6b 32 9c 14 76 03 0a a3 5a 98 aa 2a 93 34>,
  absValidity: 2018-03-20T20:01:12.393Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 1c bd 6f b8 23 ee 08 e5>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 1c bd 6f b8 23 ee 08 e5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.67:49048',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100453
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56652
received auth hello!
{ authId: 501, nonce: <Buffer e3 19 71 cf bb 05 a4 09> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer cd f4 2c 5d 21 63 a8 ba>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 6b c0 ac 6f 89 c8 e8 5e>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 6b c0 ac 6f 89 c8 e8 5e> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.67:49302',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100461
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 56922
received auth hello!
{ authId: 501, nonce: <Buffer 7a 6b 02 e3 6f 59 46 3f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 38 98 18 a5 ea fd 78 6b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 13 8d 48 7d d9 db 0e 74>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 13 8d 48 7d d9 db 0e 74> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.67:49572',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100469
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57192
received auth hello!
{ authId: 501, nonce: <Buffer f8 e9 04 25 14 b2 01 2a> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 0a 2b 71 f9 02 03 0b d9>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e9 8b 28 d5 80 46 b3 2c>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e9 8b 28 d5 80 46 b3 2c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.67:49842',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100477
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57462
received auth hello!
{ authId: 501, nonce: <Buffer c8 36 cb 77 51 da 64 7b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c7 d9 9a af a2 f2 a2 3c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer ba bc 14 f2 43 4a 80 c7>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer ba bc 14 f2 43 4a 80 c7> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.67:50112',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100485
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 57732
received auth hello!
{ authId: 501, nonce: <Buffer 86 00 89 98 f9 38 92 92> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer f8 db 5e e4 eb b8 14 20>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 09 c6 db 8f f6 f1 6c e8>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 09 c6 db 8f f6 f1 6c e8> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.67:50382',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100493
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 58002
received auth hello!
{ authId: 501, nonce: <Buffer b7 06 d1 1f 77 f7 1d 03> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer cf a6 e5 47 e0 f6 2c 92>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 54 d0 04 c3 93 fb f8 83>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 54 d0 04 c3 93 fb f8 83> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.67:50652',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200480
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200495
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 45998
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200510
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 46270
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 401, nonce: <Buffer 0b c0 7b ce 17 c7 6a a8> }
received an Auth alert!
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: received an Auth alert! code: 1
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50200525
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
