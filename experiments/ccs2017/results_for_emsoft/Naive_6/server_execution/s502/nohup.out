changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s502.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's502',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 6f 77 49 42 41 41 4b 43 41 51 45 41 34 31 ... > }
Handler: listening on port 22100
s502:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100611
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 53148
received auth hello!
{ authId: 501, nonce: <Buffer bb 53 5a a7 13 77 09 4f> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 6f ab 77 ad be ee b3 02>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 2e 64 9c 5a d7 60 92 da fa 7b 0c 20 78 bc 13 14>,
  macKeyVal: <Buffer a5 4c ba fa 34 9d cb 70 98 2d f3 8d af f0 fc 02 16 b0 18 83 34 72 1f 3a 3d 73 82 f2 cf 87 73 8c>,
  absValidity: 2018-03-20T23:09:46.666Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer c1 d6 f9 17 3c 54 be a5>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer c1 d6 f9 17 3c 54 be a5> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.63:39252',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100619
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 53380
received auth hello!
{ authId: 501, nonce: <Buffer 59 2f ff 35 05 99 74 f6> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c1 bc 2c fa d6 81 f0 8d>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 69 31 56 67 9c 79 a3 94>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 69 31 56 67 9c 79 a3 94> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.63:39482',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100627
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 53650
received auth hello!
{ authId: 501, nonce: <Buffer e1 ed 2a ea 2c eb 48 52> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 68 dd 55 a2 37 98 2b f4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 58 1c 1e 93 c9 4c ea 87>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 58 1c 1e 93 c9 4c ea 87> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.63:39752',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100635
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 53920
received auth hello!
{ authId: 501, nonce: <Buffer ed 8a 29 26 cf 64 47 c1> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 0f 78 ce 69 ad 22 9a ea>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d5 07 33 fd c6 42 46 ad>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d5 07 33 fd c6 42 46 ad> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.63:40022',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100643
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54192
received auth hello!
{ authId: 501, nonce: <Buffer 49 3d 5f 93 bd 03 48 1c> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer a5 20 2b c8 45 87 a1 6c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 6c fd 99 4f 80 57 5c c3>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 6c fd 99 4f 80 57 5c c3> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.63:40294',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100651
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54462
received auth hello!
{ authId: 501, nonce: <Buffer 7e 4e 7b 3c 0e 9c 50 5b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer fb 9d 53 6a 1c 89 8a 0b>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer f5 84 65 24 df 2f 97 de>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer f5 84 65 24 df 2f 97 de> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.63:40564',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50100659
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 54732
received auth hello!
{ authId: 501, nonce: <Buffer d8 9f ed d6 3d 03 be 59> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 05 0d 8a 3a 81 5c 41 27>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer d8 2f 44 ad 73 3f e9 fb>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer d8 2f 44 ad 73 3f e9 fb> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.63:40834',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201424
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201554
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.1:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201568
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 3
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 0
to: 1
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
Handler: Error in server - details: handshake2 timed out...
failure in migration to another Auth : migrationFailureCount: 1
Handler: Error in server - details: Error occurred in migration request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
failure in migration to another Auth : migrationFailureCount: 2
Handler: Error in server - details: Error occurred in migration request: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201582
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 4
failure count reached threshold (2), try migration...
reached migration failure threshold, rotate migration info index from: 1
to: 2
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.4:21100
connected to auth! from local port 44260
Handler: Error in server - details: handshake2 timed out...
received auth hello!
{ authId: 502, nonce: <Buffer 1e e4 81 b9 61 a4 1e c3> }
more data will come. current: 1445 expected: 1485
received migration response with signature!
{ version: 2,
  subject: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth502',
     commonName: '10.0.1.5' },
  issuer: 
   { countryName: 'US',
     stateOrProvinceName: 'CA',
     localityName: 'Berkeley',
     organizationName: 'EECS',
     organizationalUnitName: 'Auth501',
     commonName: '10.0.0.4' },
  serial: '016245740808',
  notBefore: 2018-03-20T22:05:54.000Z,
  notAfter: 2018-03-21T22:07:34.000Z,
  subjectHash: '9638ffe3',
  signatureAlgorithm: 'sha256WithRSAEncryption',
  fingerPrint: 'E4:19:6D:0C:8B:16:48:A2:32:B6:94:73:F6:80:86:72:13:AA:3E:3D',
  publicKey: 
   { algorithm: 'rsaEncryption',
     e: '65537',
     n: 'E40B9EF20959AA49D02016EC2E9896074EE0818689EAD7319ECC8ED8C9557412ED46C95E67464598F6233ECEB8BF25A876F0D30B65CED2B1FED8D1F07CF9042FD7F86E3B637BE17FBFD7C9F0DB5850835170B354A52C175B769A37BA578F965436FF29BCFD54C5D4E939E02214503C8A69FFBBF0EC06657DF9498BE98DEB26B62E1453817F6DFAE9B50EE21C5A643FF0292539838A682562303CB77FC6028B22B30B78957E4F78E539103F991928681EBF3100D31960F43F8ECFC6C2F3063B353E92BFFEF77A49BBCBF417864AE8169AA061F590E5FB3393A4592EFA1100FC186B95B83724CA0B11D8BC02BC9BD4F9E08552DE2D1EB0EE0E866E41A520730E6F',
     bitSize: 2048 },
  altNames: [],
  extensions: { subjectAlternativeName: 'IP Address:10.0.1.5' } }
null
true
Certificate of new Auth is verified!
Subject information matches Auth ID!
Signature of new Auth is verified.
Auth nonce is verified
migration completed!
new Auth info: !
{ id: 502,
  host: '10.0.1.5',
  port: 21100,
  publicKey: '-----BEGIN CERTIFICATE-----\nMIIDVTCCAj2gAwIBAgIGAWJFdAgIMA0GCSqGSIb3DQEBCwUAMGExCzAJBgNVBAYT\nAlVTMQswCQYDVQQIDAJDQTERMA8GA1UEBwwIQmVya2VsZXkxDTALBgNVBAoMBEVF\nQ1MxEDAOBgNVBAsMB0F1dGg1MDExETAPBgNVBAMMCDEwLjAuMC40MB4XDTE4MDMy\nMDIyMDU1NFoXDTE4MDMyMTIyMDczNFowYTELMAkGA1UEBhMCVVMxCzAJBgNVBAgM\nAkNBMREwDwYDVQQHDAhCZXJrZWxleTENMAsGA1UECgwERUVDUzEQMA4GA1UECwwH\nQXV0aDUwMjERMA8GA1UEAwwIMTAuMC4xLjUwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQDkC57yCVmqSdAgFuwumJYHTuCBhonq1zGezI7YyVV0Eu1GyV5n\nRkWY9iM+zri/Jah28NMLZc7Ssf7Y0fB8+QQv1/huO2N74X+/18nw21hQg1Fws1Sl\nLBdbdpo3ulePllQ2/ym8/VTF1Ok54CIUUDyKaf+78OwGZX35SYvpjesmti4UU4F/\nbfrptQ7iHFpkP/ApJTmDimglYjA8t3/GAosiswt4lX5PeOU5ED+ZGShoHr8xANMZ\nYPQ/js/GwvMGOzU+kr/+93pJu8v0F4ZK6BaaoGH1kOX7M5OkWS76EQD8GGuVuDck\nygsR2LwCvJvU+eCFUt4tHrDuDoZuQaUgcw5vAgMBAAGjEzARMA8GA1UdEQQIMAaH\nBAoAAQUwDQYJKoZIhvcNAQELBQADggEBABkJcVLNsxiUWt25hTnwKEx7IA6XcBdq\nQAG5AQhTIOW7Dy3BCfN8WaAdvH2bBAdeBUGoge6adhSadohUK/dBWzdfL1zKcXQ8\nt8riR0jbgml5opFtx57BaKJUWeVwvWoj4kouLbEalRJw/EuULcxV4+2A1n6Q+q3I\nqrLJBmIRounZCERGRmOwXgkQ/kIEdgSsHQmOqQ1Vs6Fc4jmsyIWkAGiGoWsdRs33\nCc+Ls/p3Qf+m6jz5zrzelh5dAsNBC1hRc3Z5O1fHDPAJ8Ak8YOWhflE+vHQKt2dt\nEAoR7vwzF2xK/1u19vbMdzwqAOiZGFvuXqg5WBgHciMzXbSKh6gYx1I=\n-----END CERTIFICATE-----' }
received migration response, for next round of migration, rotate migration info index from: 2
to: 3
disconnected from auth
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201595
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 44408
received auth hello!
{ authId: 502, nonce: <Buffer f6 21 59 b6 68 97 28 c9> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 2f 64 f5 4b c9 d1 a1 c3>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 29 9b 36 c7 4e 16 fa 5e 86 1d e0 60 d5 e8 d9 d6>,
  macKeyVal: <Buffer 61 59 2c 81 7a 4a 01 45 03 94 b0 47 90 4d 68 66 80 d0 4d 5b 19 c7 e4 3c 00 fa 90 07 d3 d4 a2 d5>,
  absValidity: 2018-03-20T23:32:54.099Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 3e d0 1e e3 c4 01 30 22>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 3e d0 1e e3 c4 01 30 22> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 7,
  remoteAddress: '::ffff:10.0.1.63:43920',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 7 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 7 }
specified socketID: 7
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #7 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50201636
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 44914
received auth hello!
{ authId: 502, nonce: <Buffer 33 db 45 cd bc 32 d0 4b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 75 12 45 4b 9f 22 af c6>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer e8 02 4a e2 25 1e 37 37>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer e8 02 4a e2 25 1e 37 37> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 8,
  remoteAddress: '::ffff:10.0.1.63:44426',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 8 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 8 }
specified socketID: 8
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #8 closed
