changing working directory to: /home/hokeunkim/Development/iotauth/entity/node/example_entities
loading from config file: /home/hokeunkim/Development/iotauth_experiments/experiments/ccs2017/expOptions/expEntity.option
Experimental options for echoServer: { autoSendPeriod: 60000,
  useSameSessionKeyCount: 1,
  connectionTimeout: 50000,
  migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
loading from config file: /home/hokeunkim/Development/iotauth/entity/node/example_entities/configs/Servers/s409.config
initializing secure comm server...
Session protocol: TCP
current parameters: { migrationEnabled: true,
  authFailureThreshold: 3,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 3 }
current parameters: { migrationEnabled: true,
  authFailureThreshold: 2,
  migrationFailureThreshold: 2 }
current entityInfo: { name: 's409',
  group: 'Servers',
  distProtocol: 'TCP',
  usePermanentDistKey: false,
  connectionTimeout: 50000,
  privateKey: <Buffer 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0a 4d 49 49 45 70 41 49 42 41 41 4b 43 41 51 45 41 78 53 ... > }
Handler: listening on port 22100
s409:Servers prompt>
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200202
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 38756
received auth hello!
{ authId: 402, nonce: <Buffer 87 9c 57 35 c6 fe 67 a3> }
received session key response with distribution key attached!
auth signature verified
replyNonce in sessionKeyResp: <Buffer 78 35 45 00 40 94 86 c7>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
updating distribution key: { cipherKeyVal: <Buffer 86 d9 88 e3 84 b3 16 17 ba b7 c0 6b 8f e8 29 61>,
  macKeyVal: <Buffer 9e 80 72 0a 63 e6 ad ba c4 38 20 07 de c2 52 50 1f 8e ea bf f3 d2 bf e5 b6 bb 60 0a 9d 31 da 7b>,
  absValidity: 2018-03-21T01:40:15.485Z }
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5d 14 8d 3b 28 66 e3 aa>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 5d 14 8d 3b 28 66 e3 aa> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 0,
  remoteAddress: '::ffff:10.0.1.55:56156',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 0 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 0 }
specified socketID: 0
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #0 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200209
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 38944
received auth hello!
{ authId: 402, nonce: <Buffer 54 ce 7b fe a1 d8 d6 0f> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer c9 49 4a 11 2a 23 a9 0a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 46 bf 53 55 fe 6e 9a 98>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 46 bf 53 55 fe 6e 9a 98> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 1,
  remoteAddress: '::ffff:10.0.1.55:56342',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 1 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 1 }
specified socketID: 1
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #1 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200216
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 39216
received auth hello!
{ authId: 402, nonce: <Buffer df b5 02 50 97 5a dc a7> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer bd b3 ab 24 ce d3 77 91>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 03 a3 e8 2f c1 88 39 12>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 03 a3 e8 2f c1 88 39 12> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 2,
  remoteAddress: '::ffff:10.0.1.55:56614',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 2 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 2 }
specified socketID: 2
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #2 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200223
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 39486
received auth hello!
{ authId: 402, nonce: <Buffer 5e b4 65 2f 90 da 77 89> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer ef de 99 39 d2 08 0c f4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer a1 0a 14 91 eb e3 96 0d>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer a1 0a 14 91 eb e3 96 0d> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 3,
  remoteAddress: '::ffff:10.0.1.55:56884',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 3 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 3 }
specified socketID: 3
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #3 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200230
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 39756
received auth hello!
{ authId: 402, nonce: <Buffer 7b 96 18 3a 35 e0 6c 0b> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 09 94 4e f0 5e 75 1e 0a>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer db c8 26 50 88 74 00 60>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer db c8 26 50 88 74 00 60> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 4,
  remoteAddress: '::ffff:10.0.1.55:57154',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 4 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 4 }
specified socketID: 4
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #4 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200237
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 40026
received auth hello!
{ authId: 402, nonce: <Buffer df bb a8 72 a3 2c 6b dc> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 5e 27 cc 8e 2e 25 99 f4>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 59 c4 2f 5b 38 ff 90 0c>
switching to HANDSHAKE_2_SENT
disconnected from auth
received session key handshake3!
{ replyNonce: <Buffer 59 c4 2f 5b 38 ff 90 0c> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 5,
  remoteAddress: '::ffff:10.0.1.55:57424',
  status: 'open' }
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 5 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 5 }
specified socketID: 5
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #5 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 40200244
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
connected to auth! from local port 40296
received auth hello!
{ authId: 402, nonce: <Buffer 43 93 57 7e 3b 6f c0 b2> }
received session key response encrypted with distribution key
replyNonce in sessionKeyResp: <Buffer 15 12 05 6f 3c 15 40 2c>
auth nonce verified
handleSessionKeyResp: session key request succeeded! authFailureCount: 0
received 1 keys
Session key id is as expected
server ret: [object Object]
chosen nonce: <Buffer 5f 3b 17 68 38 98 d4 3b>
switching to HANDSHAKE_2_SENT
received session key handshake3!
{ replyNonce: <Buffer 5f 3b 17 68 38 98 d4 3b> }
client authenticated/authorized by solving nonce!
switching to IN_COMM
Handler: secure connection with the client established.
{ id: 6,
  remoteAddress: '::ffff:10.0.1.55:57694',
  status: 'open' }
disconnected from auth
received secure communication!
Received seqNum: 0
data received from server via secure communication
Handler: socketID: 6 data: data1
toSend: { data: <Buffer 64 61 74 61 31>, id: 6 }
specified socketID: 6
Unidentified client disconnected
Handler: secure connection with the client closed.
socket #6 closed
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300182
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 1
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
Handler: Error in server - details: handshake2 timed out...
Unidentified client disconnected
Handler: Error in server - details: Closed during comm init from undefined:undefined
Handler: Error in server - details: Auth hello timedout ...
Unidentified client connected
received session key handshake1
switching to HANDSHAKE_1_RECEIVED state.
session key id: 50300188
session key NOT found! sending session key id to AuthService
Distribution protocol: TCP
failure in connection with Auth : authFailureCount: 2
failure count reached threshold (2), try migration...
In iotAuth.js migrateToTrustedAuth: 
In iotAuthService.js sendMigrationReqViaTCP: 
Handler: Error in server - details: Error occurred in session key request: Error: connect EHOSTUNREACH 10.0.1.2:21100
connected to auth! from local port 49280
Handler: Error in server - details: handshake2 timed out...
/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902
            eventHandlers.onError('Error occurred in migration request: Disconnected from auth before getting migration response: ' + error);
                                                                                                                                      ^

ReferenceError: error is not defined
    at Socket.<anonymous> (/home/hokeunkim/Development/iotauth/entity/node/accessors/node_modules/iotAuthService.js:902:135)
    at emitNone (events.js:91:20)
    at Socket.emit (events.js:188:7)
    at endReadableNT (_stream_readable.js:975:12)
    at _combinedTickCallback (internal/process/next_tick.js:80:11)
    at process._tickCallback (internal/process/next_tick.js:104:9)
